<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compagnon Spirituel</title>

    <!-- Styles & Librairies externes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Configuration Tailwind pour supprimer l'avertissement
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'islamic-green': '#00a86b',
              'warm-white': '#fefcf9'
            }
          }
        }
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/locale/fr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/moment-hijri.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Polices & PWA -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Amiri:wght@400;700&family=Lato:wght@300;400;700&family=Orbitron:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#fdfaf6" />

    <!-- CSS uniquement -->
    <style>
      :root {
        --bg: linear-gradient(135deg, #fdfbf7 0%, #f7f3ed 100%);
        --card: rgba(255, 255, 255, 0.95);
        --card-hover: rgba(255, 255, 255, 0.98);
        --ink: #2c1810;
        --muted: #8b7355;
        --brand: #d97706;
        --ring: #059669;
        --gold: #f59e0b;
        --islamic-green: #00a86b;
        --warm-white: #fefcf9;
        --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.15);
        --gradient-islamic: linear-gradient(135deg, #00a86b 0%, #059669 100%);
        --gradient-warm: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        --border-soft: rgba(139, 115, 85, 0.2);
      }

      html,
      body {
        height: 100%;
        background: var(--bg);
        background-attachment: fixed;
        font-family:
          "Lato",
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          "Helvetica Neue",
          Arial,
          "Noto Sans",
          "Liberation Sans",
          sans-serif;
        color: var(--ink);
      }

      .title {
        font-family: "Amiri", serif;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .clock {
        font-family: "Orbitron", monospace;
        letter-spacing: 0.06em;
        background: var(--gradient-warm);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .card {
        background: var(--card);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        box-shadow: var(--shadow-soft);
        border: 1px solid var(--border-soft);
        padding: 2rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-islamic);
        border-radius: 24px 24px 0 0;
      }

      .card:hover {
        background: var(--card-hover);
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
      }

      .tab-btn {
        position: relative;
        padding: 0.75rem 1.5rem;
        border-radius: 16px;
        transition: all 0.3s ease;
        font-weight: 500;
        color: var(--muted);
        border: 1px solid transparent;
      }

      .tab-btn[aria-selected="true"] {
        background: var(--gradient-islamic);
        color: white;
        box-shadow: 0 8px 25px rgba(0, 168, 107, 0.3);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .tab-btn:hover:not([aria-selected="true"]) {
        background: rgba(0, 168, 107, 0.1);
        color: var(--islamic-green);
        border-color: rgba(0, 168, 107, 0.2);
      }

      .badge {
        background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
        color: #92400e;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        font-size: 0.875rem;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        border: 1px solid rgba(251, 191, 36, 0.2);
      }

      .qibla-rose {
        width: 280px;
        height: 280px;
        border-radius: 50%;
        border: 12px solid var(--islamic-green);
        background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(0,168,107,0.1) 100%);
        position: relative;
        margin: auto;
        box-shadow: 0 20px 60px rgba(0, 168, 107, 0.2);
      }

      .qibla-rose::after {
        content: "ÿßŸÑÿ¥ŸÖÿßŸÑ";
        position: absolute;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        color: var(--islamic-green);
        font-weight: 700;
        font-family: "Amiri", serif;
        font-size: 1.1rem;
      }

      .qibla-arrow {
        position: absolute;
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-bottom: 100px solid var(--islamic-green);
        left: 50%;
        top: 50%;
        transform-origin: 50% 90%;
        transform: translate(-50%, -80%) rotate(0deg);
        filter: drop-shadow(0 10px 20px rgba(0, 168, 107, 0.4));
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Animations spirituelles */
      @keyframes breathe {
        0%, 100% { transform: scale(1) translateY(0px); opacity: 0.9; }
        50% { transform: scale(1.02) translateY(-3px); opacity: 1; }
      }

      @keyframes shimmer {
        0% { background-position: -200% center; }
        100% { background-position: 200% center; }
      }

      .special-notification {
        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(0, 168, 107, 0.2);
        border-radius: 20px;
        padding: 1.5rem 2rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 15px 40px rgba(0, 168, 107, 0.1);
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
      }

      .special-notification::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 168, 107, 0.1), transparent);
        animation: shimmer 3s infinite;
      }

      .special-notification:hover {
        transform: translateY(-3px);
        box-shadow: 0 25px 60px rgba(0, 168, 107, 0.2);
        border-color: rgba(0, 168, 107, 0.4);
      }

      .notification-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        margin-right: 1rem;
        font-size: 1.25rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      /* Styles pour le texte arabe am√©lior√©s */
      .arabic-text {
        font-family: "Amiri Quran", "Amiri", serif;
        font-size: 1.75rem;
        line-height: 2.5;
        direction: rtl;
        text-align: right;
        color: var(--ink);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .ayah-container {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-right: 6px solid var(--islamic-green);
        padding: 2rem;
        margin-bottom: 1.5rem;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 168, 107, 0.1);
      }

      .ayah-number {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2.5rem;
        height: 2.5rem;
        background: var(--gradient-islamic);
        color: white;
        border-radius: 50%;
        font-size: 1rem;
        font-weight: bold;
        margin-left: 1rem;
        margin-bottom: 0.75rem;
        box-shadow: 0 6px 20px rgba(0, 168, 107, 0.3);
      }

      .ayah-marker {
        font-size: 1rem;
        margin: 0 0.5rem;
        opacity: 0.9;
        color: var(--islamic-green);
        font-weight: bold;
      }

      /* Styles pour les cartes de pri√®res modernis√©es */
      .prayer-card {
        background: var(--card);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-soft);
        border-radius: 20px;
        padding: 1.5rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .prayer-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--gradient-islamic);
        border-radius: 20px 20px 0 0;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .prayer-card.ring {
        background: linear-gradient(135deg, rgba(0, 168, 107, 0.15) 0%, rgba(0, 168, 107, 0.05) 100%);
        border-color: var(--islamic-green);
        box-shadow: 0 0 30px rgba(0, 168, 107, 0.25);
        transform: translateY(-3px) scale(1.02);
        animation: breathe 3s infinite ease-in-out;
      }

      .prayer-card.ring::before {
        opacity: 1;
      }

      .prayer-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
      }

      .prayer-card.ring:hover {
        transform: translateY(-4px) scale(1.02);
      }

      /* Conteneur de lecture modernis√© */
      #surah-wrap {
        max-width: 65rem;
        margin-inline: auto;
        background: var(--card);
        border-radius: 24px;
        padding: 3rem;
        box-shadow: var(--shadow-soft);
        border: 1px solid var(--border-soft);
      }

      /* Titre et basmala modernis√©s */
      #surah-title {
        text-align: center;
        margin: 1rem 0 2rem;
        font-weight: 700;
        font-size: 2.5rem;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-family: "Amiri", serif;
      }

      .bismillah {
        display: block;
        text-align: center;
        margin: 1rem 0 2rem;
        font-size: 2rem;
        color: var(--islamic-green);
        text-shadow: 0 2px 8px rgba(0, 168, 107, 0.2);
      }

      /* Bloc de texte mushaf modernis√© */
      .ayahs-block {
        font-family: "Amiri Quran", "Amiri", serif;
        direction: rtl;
        text-align: justify;
        text-justify: inter-word;
        font-size: 1.8rem;
        line-height: 3.6rem;
        color: var(--ink);
        word-break: break-word;
        background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(248,250,252,0.8) 100%);
        padding: 2rem 1rem;
        border-radius: 16px;
        border: 1px solid var(--border-soft);
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        word-spacing: 0.12em;
        letter-spacing: 0.02em;
        hyphens: none;
      }

      /* Pastille du num√©ro de verset modernis√©e */
      .ayah-badge {
        display: inline-block;
        min-width: 2.2em;
        height: 2.2em;
        line-height: 2.2em;
        margin: 0 0.6rem;
        border-radius: 50%;
        text-align: center;
        font-size: 1rem;
        font-weight: 800;
        color: #2c1810;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
        box-shadow: 
          0 4px 12px rgba(217, 119, 6, 0.4),
          0 2px 6px rgba(0, 0, 0, 0.1),
          inset 0 1px 0 rgba(255, 255, 255, 0.6);
        vertical-align: middle;
        direction: ltr;
        border: 2px solid rgba(255, 255, 255, 0.9);
        font-family: "Orbitron", monospace;
        letter-spacing: -0.02em;
        text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
        position: relative;
        overflow: hidden;
      }

      .ayah-badge::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle at center, rgba(255, 255, 255, 0.3) 0%, transparent 50%);
        transform: scale(0);
        transition: transform 0.3s ease;
      }

      .ayah-badge:hover::before {
        transform: scale(1);
      }

      @media (max-width: 768px) {
        .card {
          padding: 1.5rem;
          margin: 0.5rem;
          border-radius: 16px;
        }

        .journal-section {
          padding: 1.5rem;
          margin-bottom: 1.5rem;
        }

        .tasbih-counter {
          font-size: 3.5rem;
          margin: 1rem 0;
        }

        .tasbih-button {
          width: 9rem;
          height: 9rem;
          font-size: 1.1rem;
        }

        /* Navigation sticky optimis√©e mobile */
        nav {
          position: fixed;
          bottom: 0;
          top: auto;
          background: rgba(253, 250, 246, 0.95);
          backdrop-filter: blur(20px);
          border-top: 1px solid rgba(139, 115, 85, 0.2);
          border-bottom: none;
          padding: 0.5rem 0;
          z-index: 30;
        }

        nav ul {
          justify-content: center;
          gap: 0.25rem;
          padding: 0 0.5rem;
        }

        .tab-btn {
          padding: 0.5rem 0.75rem;
          font-size: 0.75rem;
          border-radius: 12px;
          min-width: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.25rem;
        }

        /* Ajouter des ic√¥nes aux onglets mobile */
        .tab-btn[data-tab="accueil"]::before { content: "üè†"; font-size: 1rem; }
        .tab-btn[data-tab="programme"]::before { content: "üìã"; font-size: 1rem; }
        .tab-btn[data-tab="lectures"]::before { content: "üìñ"; font-size: 1rem; }
        .tab-btn[data-tab="retraite"]::before { content: "üïå"; font-size: 1rem; }
        .tab-btn[data-tab="journal"]::before { content: "üìù"; font-size: 1rem; }
        .tab-btn[data-tab="mois"]::before { content: "üåô"; font-size: 1rem; }
        .tab-btn[data-tab="qibla"]::before { content: "üß≠"; font-size: 1rem; }

        /* Ajuster le contenu principal pour la nav bottom */
        main {
          padding-bottom: 6rem;
        }

        /* Header plus compact sur mobile */
        header {
          padding: 2rem 1rem;
        }

        header h1 {
          font-size: 2.5rem;
        }

        /* Am√©liorer les cards pri√®res sur mobile */
        .prayer-card {
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        /* Focus du jour plus compact */
        #daily-focus-content {
          font-size: 1rem;
          padding: 1rem;
        }
      }

      /* Styles sp√©ciaux pour la page Journal */
      .journal-section {
        background: var(--card);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 2.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border-soft);
        box-shadow: var(--shadow-soft);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .journal-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-islamic);
        border-radius: 24px 24px 0 0;
      }

      .journal-section:hover {
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
      }

      .journal-title {
        font-family: "Amiri", serif;
        font-size: 2rem;
        font-weight: 700;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-align: center;
        margin-bottom: 2rem;
        position: relative;
      }

      .journal-title::after {
        content: '';
        position: absolute;
        bottom: -0.5rem;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: var(--gradient-warm);
        border-radius: 2px;
      }

      .checkbox-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,250,252,0.9) 100%);
        border-radius: 16px;
        border: 1px solid var(--border-soft);
        transition: all 0.3s ease;
        margin-bottom: 0.75rem;
      }

      .checkbox-container:hover {
        background: linear-gradient(135deg, rgba(0,168,107,0.05) 0%, rgba(0,168,107,0.02) 100%);
        border-color: var(--islamic-green);
        box-shadow: 0 8px 25px rgba(0, 168, 107, 0.1);
      }

      .checkbox-container input[type="checkbox"] {
        width: 1.25rem;
        height: 1.25rem;
        accent-color: var(--islamic-green);
        border-radius: 4px;
      }

      .checkbox-container label {
        font-weight: 500;
        color: var(--ink);
        cursor: pointer;
        flex: 1;
      }

      .tasbih-section {
        text-align: center;
        background: linear-gradient(135deg, rgba(0,168,107,0.05) 0%, rgba(245,158,11,0.05) 100%);
        border-radius: 24px;
        padding: 3rem;
        border: 1px solid var(--border-soft);
        position: relative;
        overflow: hidden;
      }

      .tasbih-section::before {
        content: 'Ô∑Ω';
        position: absolute;
        top: 1rem;
        right: 1.5rem;
        font-size: 1.5rem;
        color: var(--islamic-green);
        opacity: 0.3;
      }

      .tasbih-counter {
        font-family: "Orbitron", monospace;
        font-size: 6rem;
        font-weight: 700;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 2rem 0;
        text-shadow: 0 4px 20px rgba(0, 168, 107, 0.3);
      }

      .tasbih-button {
        width: 12rem;
        height: 12rem;
        border-radius: 50%;
        background: var(--gradient-islamic);
        border: none;
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 20px 60px rgba(0, 168, 107, 0.3);
        margin: 2rem auto;
        position: relative;
        overflow: hidden;
      }

      .tasbih-button::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
        transform: scale(0);
        transition: transform 0.6s ease;
      }

      .tasbih-button:active::before {
        transform: scale(1);
      }

      .tasbih-button:hover {
        transform: scale(1.05);
        box-shadow: 0 30px 80px rgba(0, 168, 107, 0.4);
      }

      .tasbih-button:active {
        transform: scale(0.95);
      }

      .notes-textarea {
        width: 100%;
        min-height: 200px;
        padding: 2rem;
        border: 2px solid var(--border-soft);
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.9) 100%);
        font-family: "Lato", sans-serif;
        font-size: 1rem;
        line-height: 1.6;
        color: var(--ink);
        resize: vertical;
        transition: all 0.3s ease;
      }

      .notes-textarea:focus {
        outline: none;
        border-color: var(--islamic-green);
        box-shadow: 0 0 0 4px rgba(0, 168, 107, 0.1);
        background: rgba(255, 255, 255, 0.98);
      }

      .notes-textarea::placeholder {
        color: var(--muted);
        font-style: italic;
      }

      @media (max-width: 768px) {
        .card {
          padding: 1.5rem;
        }

        .journal-section {
          padding: 2rem;
        }

        .tasbih-counter {
          font-size: 4rem;
        }

        .tasbih-button {
          width: 10rem;
          height: 10rem;
          font-size: 1.25rem;
        }

        .ayahs-block {
          font-size: 1.6rem;
          line-height: 3.2rem;
          padding: 2.5rem 1.5rem;
          word-spacing: 0.08em;
          letter-spacing: 0.01em;
        }
      }

      /* Styles sp√©ciaux pour la page Journal */
      .journal-section {
        background: var(--card);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 2.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border-soft);
        box-shadow: var(--shadow-soft);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .journal-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-islamic);
        border-radius: 24px 24px 0 0;
      }

      .journal-section:hover {
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
      }

      .journal-title {
        font-family: "Amiri", serif;
        font-size: 2rem;
        font-weight: 700;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-align: center;
        margin-bottom: 2rem;
        position: relative;
      }

      .journal-title::after {
        content: '';
        position: absolute;
        bottom: -0.5rem;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: var(--gradient-warm);
        border-radius: 2px;
      }

      .checkbox-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,250,252,0.9) 100%);
        border-radius: 16px;
        border: 1px solid var(--border-soft);
        transition: all 0.3s ease;
        margin-bottom: 0.75rem;
      }

      .checkbox-container:hover {
        background: linear-gradient(135deg, rgba(0,168,107,0.05) 0%, rgba(0,168,107,0.02) 100%);
        border-color: var(--islamic-green);
        box-shadow: 0 8px 25px rgba(0, 168, 107, 0.1);
      }

      .checkbox-container input[type="checkbox"] {
        width: 1.25rem;
        height: 1.25rem;
        accent-color: var(--islamic-green);
        border-radius: 4px;
      }

      .checkbox-container label {
        font-weight: 500;
        color: var(--ink);
        cursor: pointer;
        flex: 1;
      }

      .tasbih-section {
        text-align: center;
        background: linear-gradient(135deg, rgba(0,168,107,0.05) 0%, rgba(245,158,11,0.05) 100%);
        border-radius: 24px;
        padding: 3rem;
        border: 1px solid var(--border-soft);
        position: relative;
        overflow: hidden;
      }

      .tasbih-section::before {
        content: 'Ô∑Ω';
        position: absolute;
        top: 1rem;
        right: 1.5rem;
        font-size: 1.5rem;
        color: var(--islamic-green);
        opacity: 0.3;
      }

      .tasbih-counter {
        font-family: "Orbitron", monospace;
        font-size: 6rem;
        font-weight: 700;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 2rem 0;
        text-shadow: 0 4px 20px rgba(0, 168, 107, 0.3);
      }

      .tasbih-button {
        width: 12rem;
        height: 12rem;
        border-radius: 50%;
        background: var(--gradient-islamic);
        border: none;
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 20px 60px rgba(0, 168, 107, 0.3);
        margin: 2rem auto;
        position: relative;
        overflow: hidden;
      }

      .tasbih-button::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
        transform: scale(0);
        transition: transform 0.6s ease;
      }

      .tasbih-button:active::before {
        transform: scale(1);
      }

      .tasbih-button:hover {
        transform: scale(1.05);
        box-shadow: 0 30px 80px rgba(0, 168, 107, 0.4);
      }

      .tasbih-button:active {
        transform: scale(0.95);
      }

      .notes-textarea {
        width: 100%;
        min-height: 200px;
        padding: 2rem;
        border: 2px solid var(--border-soft);
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.9) 100%);
        font-family: "Lato", sans-serif;
        font-size: 1rem;
        line-height: 1.6;
        color: var(--ink);
        resize: vertical;
        transition: all 0.3s ease;
      }

      .notes-textarea:focus {
        outline: none;
        border-color: var(--islamic-green);
        box-shadow: 0 0 0 4px rgba(0, 168, 107, 0.1);
        background: rgba(255, 255, 255, 0.98);
      }

      .notes-textarea::placeholder {
        color: var(--muted);
        font-style: italic;
      }
    </style>
  </head>

  <body class="text-slate-800">
    <!-- Header -->
    <header class="max-w-5xl mx-auto px-4 py-10">
      <h1 class="title text-center text-5xl sm:text-6xl text-slate-800">
        Compagnon Spirituel
      </h1>
      <p class="text-center text-[var(--brand)] mt-2">
        Votre guide spirituel quotidien
      </p>

      <!-- Horloge & Dates -->
      <div class="mt-8 card max-w-xl mx-auto text-center">
        <div id="clock" class="clock text-5xl sm:text-6xl text-slate-700">
          --:--:--
        </div>
        <div class="mt-5">
          <div id="date-greg" class="font-semibold text-sky-600">‚Äî</div>
          <div id="date-hijri" class="text-slate-500 font-medium">‚Äî</div>
          <div id="month-detail" class="text-sm text-slate-400 mt-2 italic max-w-md mx-auto">‚Äî</div>
        </div>
        <div class="mt-4">
          <span id="mode-badge" class="badge">Planning Annuel</span>
        </div>
      </div>

      <!-- Focus du jour - Version modernis√©e -->
      <div class="mt-8 max-w-4xl mx-auto">
        <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-emerald-50 via-blue-50 to-indigo-100 shadow-2xl border border-white/50">
          <!-- Badge flottant -->
          <div class="absolute top-4 right-4 z-10">
            <div id="focus-mode-badge" class="inline-flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-full shadow-lg border border-emerald-200">
              <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
              <span class="text-xs font-semibold text-emerald-700"></span>
            </div>
          </div>

          <!-- Contenu principal -->
          <div class="relative p-8 md:p-12">
            <!-- Titre avec ic√¥ne anim√©e -->
            <div class="text-center mb-6">
              <div class="inline-flex items-center gap-3 mb-4">
                <div class="w-12 h-12 bg-gradient-to-r from-emerald-500 to-blue-500 rounded-full flex items-center justify-center shadow-lg">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                  </svg>
                </div>
                <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-emerald-600 via-blue-600 to-indigo-600 bg-clip-text text-transparent">
                  Focus du Jour
                </h2>
              </div>
              <p id="daily-focus-time" class="text-lg text-slate-600 font-medium"></p>
            </div>

            <!-- Contenu principal avec design moderne -->
            <div class="relative">
              <div class="absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-blue-500/10 rounded-2xl blur-xl"></div>
              <div class="relative bg-white/70 backdrop-blur-sm rounded-2xl p-6 md:p-8 border border-white/50 shadow-lg">
                <div id="daily-focus-content" class="text-lg md:text-xl text-slate-700 leading-relaxed text-center font-medium"></div>
              </div>
            </div>

            <!-- Section sp√©ciale avec effets visuels -->
            <div id="weekly-special-focus" class="mt-8 space-y-4"></div>
          </div>

          <!-- Ornements d√©coratifs -->
          <div class="absolute top-0 left-0 w-32 h-32 bg-gradient-to-br from-emerald-400/20 to-transparent rounded-full blur-2xl"></div>
          <div class="absolute bottom-0 right-0 w-40 h-40 bg-gradient-to-tl from-blue-400/20 to-transparent rounded-full blur-2xl"></div>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="sticky top-0 z-20 bg-[var(--bg)] border-y border-slate-200/70">
      <div class="max-w-5xl mx-auto px-4">
        <ul class="flex flex-wrap gap-2 sm:gap-3 py-3">
          <!-- 7 onglets -->
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="accueil"
              aria-selected="true"
            >
              Accueil
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="programme"
            >
              Programme
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="lectures"
            >
              Lectures
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="retraite"
            >
              Retraite
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="journal"
            >
              Journal
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="mois"
            >
              Mois
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="qibla"
            >
              Qibla
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Pages -->
    <main class="max-w-5xl mx-auto px-4 py-8 space-y-10">
      <!-- Accueil -->
      <section data-page="accueil">
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Prochaine pri√®re -->
          <div class="relative overflow-hidden bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 rounded-3xl shadow-xl border border-white/50">
            <!-- Ornements d√©coratifs -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-blue-400/20 to-transparent rounded-full blur-2xl"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-purple-400/20 to-transparent rounded-full blur-xl"></div>

            <div class="relative p-6">
              <!-- En-t√™te avec ic√¥ne -->
              <div class="flex items-center gap-3 mb-6">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center shadow-lg">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <div>
                  <h2 class="title text-2xl font-bold text-slate-800">Prochaine pri√®re</h2>
                  <p class="text-sm text-slate-600 flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Bobo-Dioulasso, Burkina Faso
                  </p>
                </div>
              </div>

              <!-- Prochaine pri√®re en √©vidence -->
              <div class="relative mb-6">
                <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-6 border border-white/50 shadow-lg">
                  <div class="text-center">
                    <div class="text-lg text-slate-600 mb-2">Prochaine pri√®re</div>
                    <div class="text-3xl font-bold text-slate-800 mb-2" id="next-prayer-name">‚Äî</div>
                    <div class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-full shadow-lg">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                      <span class="text-xl font-mono font-bold" id="next-prayer-eta">--:--:--</span>
                    </div>
                    <div class="text-sm text-slate-500 mt-2">temps restant</div>
                  </div>
                </div>
              </div>

              <!-- Grille des horaires -->
              <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                <div class="prayer-card group relative bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/50 shadow-md hover:shadow-lg transition-all duration-300" id="p-Fajr">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 bg-orange-400 rounded-full"></div>
                    <span class="font-semibold text-slate-700">Fajr</span>
                  </div>
                  <div class="text-lg font-mono font-bold text-slate-800" id="t-Fajr">‚Äî</div>
                </div>

                <div class="prayer-card group relative bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/50 shadow-md hover:shadow-lg transition-all duration-300" id="p-Shuruq">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                    <span class="font-semibold text-slate-700">Shuruq</span>
                  </div>
                  <div class="text-lg font-mono font-bold text-slate-800" id="t-Shuruq">‚Äî</div>
                </div>

                <div class="prayer-card group relative bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/50 shadow-md hover:shadow-lg transition-all duration-300" id="p-Dhuhr">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                    <span class="font-semibold text-slate-700">Dhuhr</span>
                  </div>
                  <div class="text-lg font-mono font-bold text-slate-800" id="t-Dhuhr">‚Äî</div>
                </div>

                <div class="prayer-card group relative bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/50 shadow-md hover:shadow-lg transition-all duration-300" id="p-Asr">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span class="font-semibold text-slate-700">Asr</span>
                  </div>
                  <div class="text-lg font-mono font-bold text-slate-800" id="t-Asr">‚Äî</div>
                </div>

                <div class="prayer-card group relative bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/50 shadow-md hover:shadow-lg transition-all duration-300" id="p-Maghrib">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 bg-red-400 rounded-full"></div>
                    <span class="font-semibold text-slate-700">Maghrib</span>
                  </div>
                  <div class="text-lg font-mono font-bold text-slate-800" id="t-Maghrib">‚Äî</div>
                </div>

                <div class="prayer-card group relative bg-white/60 backdrop-blur-sm rounded-xl p-4 border border-white/50 shadow-md hover:shadow-lg transition-all duration-300" id="p-Isha">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                    <span class="font-semibold text-slate-700">Isha</span>
                  </div>
                  <div class="text-lg font-mono font-bold text-slate-800" id="t-Isha">‚Äî</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tableau de Bord Spirituel -->
          <div class="card">
            <h2 class="title text-2xl mb-4">Tableau de Bord Spirituel</h2>

            <!-- Statistiques aujourd'hui -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div class="text-center p-4 bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl">
                <div class="text-2xl font-bold text-emerald-700" id="prayers-today">0</div>
                <div class="text-sm text-emerald-600">Pri√®res</div>
                <div class="text-xs text-emerald-500">aujourd'hui</div>
              </div>

              <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
                <div class="text-2xl font-bold text-blue-700" id="dhikr-count">0</div>
                <div class="text-sm text-blue-600">Dhikr</div>
                <div class="text-xs text-blue-500">compt√©s</div>
              </div>

              <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
                <div class="text-2xl font-bold text-purple-700" id="streak-days">0</div>
                <div class="text-sm text-purple-600">Jours</div>
                <div class="text-xs text-purple-500">cons√©cutifs</div>
              </div>

              <div class="text-center p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl">
                <div class="text-2xl font-bold text-orange-700" id="weekly-progress">0%</div>
                <div class="text-sm text-orange-600">Semaine</div>
                <div class="text-xs text-orange-500">accomplie</div>
              </div>
            </div>

            <!-- Progression des objectifs -->
            <div class="space-y-3">
              <h3 class="font-semibold text-slate-700 mb-2">Progression du Jour</h3>

              <!-- Pri√®res obligatoires -->
              <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center">
                    <span class="text-emerald-600 text-sm">ü§≤</span>
                  </div>
                  <span class="text-sm font-medium">Pri√®res obligatoires</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="prayer-progress" class="h-full bg-emerald-500 transition-all duration-300" style="width: 0%"></div>
                  </div>
                  <span class="text-xs text-slate-600" id="prayer-fraction">0/5</span>
                </div>
              </div>

              <!-- Dhikr quotidien -->
              <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                    <span class="text-blue-600 text-sm">üìø</span>
                  </div>
                  <span class="text-sm font-medium">Dhikr quotidien</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="dhikr-progress" class="h-full bg-blue-500 transition-all duration-300" style="width: 0%"></div>
                  </div>
                  <span class="text-xs text-slate-600" id="dhikr-fraction">0/100</span>
                </div>
              </div>

              <!-- Lecture Coran -->
              <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                    <span class="text-purple-600 text-sm">üìñ</span>
                  </div>
                  <span class="text-sm font-medium">Lecture du Coran</span>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="quran-progress" class="h-full bg-purple-500 transition-all duration-300" style="width: 0%"></div>
                  </div>
                  <span class="text-xs text-slate-600" id="quran-status">En attente</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Tendance et Analyse Long Terme -->
          <div class="mt-6 space-y-4">
            <!-- Graphique hebdomadaire am√©lior√© -->
            <div class="p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl">
              <h3 class="font-semibold text-slate-700 mb-3">Progression de la Semaine</h3>
              <div class="flex justify-between items-end h-20 mb-3">
                <div class="flex flex-col items-center">
                  <div class="relative">
                    <div id="weekly-day-1" class="w-8 bg-gradient-to-t from-emerald-400 to-emerald-500 rounded-t mb-1 transition-all duration-300" style="height: 25px;"></div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-emerald-600" id="weekly-score-1">3</div>
                  </div>
                  <span class="text-xs text-slate-500">L</span>
                </div>
                <div class="flex flex-col items-center">
                  <div class="relative">
                    <div id="weekly-day-2" class="w-8 bg-gradient-to-t from-emerald-400 to-emerald-500 rounded-t mb-1 transition-all duration-300" style="height: 40px;"></div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-emerald-600" id="weekly-score-2">4</div>
                  </div>
                  <span class="text-xs text-slate-500">M</span>
                </div>
                <div class="flex flex-col items-center">
                  <div class="relative">
                    <div id="weekly-day-3" class="w-8 bg-gradient-to-t from-emerald-500 to-emerald-600 rounded-t mb-1 transition-all duration-300" style="height: 50px;"></div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-emerald-700" id="weekly-score-3">5</div>
                  </div>
                  <span class="text-xs text-slate-500">M</span>
                </div>
                <div class="flex flex-col items-center">
                  <div class="relative">
                    <div id="weekly-day-4" class="w-8 bg-gradient-to-t from-emerald-500 to-emerald-600 rounded-t mb-1 transition-all duration-300" style="height: 60px;"></div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-emerald-700" id="weekly-score-4">5</div>
                  </div>
                  <span class="text-xs text-slate-500">J</span>
                </div>
                <div class="flex flex-col items-center">
                  <div class="relative">
                    <div id="weekly-day-5" class="w-8 bg-gradient-to-t from-emerald-400 to-emerald-500 rounded-t mb-1 transition-all duration-300" style="height: 45px;"></div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-emerald-600" id="weekly-score-5">4</div>
                  </div>
                  <span class="text-xs text-slate-500">V</span>
                </div>
                <div class="flex flex-col items-center">
                  <div class="relative">
                    <div id="weekly-day-6" class="w-8 bg-gradient-to-t from-emerald-300 to-emerald-400 rounded-t mb-1 transition-all duration-300" style="height: 35px;"></div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-emerald-600" id="weekly-score-6">2</div>
                  </div>
                  <span class="text-xs text-slate-500">S</span>
                </div>
                <div class="flex flex-col items-center">
                  <div class="relative">
                    <div id="weekly-day-7" class="w-8 bg-gradient-to-t from-emerald-600 to-emerald-700 rounded-t mb-1 transition-all duration-300" style="height: 70px;"></div>
                    <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-semibold text-emerald-800" id="weekly-score-7">5</div>
                  </div>
                  <span class="text-xs text-slate-500">D</span>
                </div>
              </div>
              <div class="text-center">
                <span class="text-xs text-slate-600">Pri√®res accomplies par jour</span>
              </div>
            </div>

            <!-- Analyse mensuelle -->
            <div class="grid md:grid-cols-3 gap-4">
              <div class="p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl">
                <h4 class="font-semibold text-blue-800 mb-2">Ce Mois</h4>
                <div class="text-2xl font-bold text-blue-700 mb-1" id="monthly-prayers">87%</div>
                <div class="text-sm text-blue-600">Assiduit√© aux pri√®res</div>
              </div>

              <div class="p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl">
                <h4 class="font-semibold text-purple-800 mb-2">Meilleure S√©rie</h4>
                <div class="text-2xl font-bold text-purple-700 mb-1" id="best-streak">12</div>
                <div class="text-sm text-purple-600">jours cons√©cutifs</div>
              </div>

              <div class="p-4 bg-gradient-to-br from-orange-50 to-red-50 rounded-xl">
                <h4 class="font-semibold text-orange-800 mb-2">Dhikr Total</h4>
                <div class="text-2xl font-bold text-orange-700 mb-1" id="total-dhikr-month">3,247</div>
                <div class="text-sm text-orange-600">ce mois-ci</div>
              </div>
            </div>

            <!-- Objectifs personnalisables -->
            <div class="p-4 bg-gradient-to-r from-indigo-50 to-cyan-50 rounded-xl">
              <h3 class="font-semibold text-slate-700 mb-3">üéØ Objectifs Personnels</h3>
              <div class="space-y-3">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium">Pri√®res √† l'heure</span>
                  <div class="flex items-center gap-2">
                    <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div class="h-full bg-indigo-500 transition-all duration-300" style="width: 78%"></div>
                    </div>
                    <span class="text-sm font-semibold text-indigo-600">78%</span>
                  </div>
                </div>

                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium">Lecture quotidienne</span>
                  <div class="flex items-center gap-2">
                    <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div class="h-full bg-cyan-500 transition-all duration-300" style="width: 92%"></div>
                    </div>
                    <span class="text-sm font-semibold text-cyan-600">92%</span>
                  </div>
                </div>

                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium">Dhikr quotidien (1261√ó)</span>
                  <div class="flex items-center gap-2">
                    <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div class="h-full bg-purple-500 transition-all duration-300" style="width: 65%"></div>
                    </div>
                    <span class="text-sm font-semibold text-purple-600">65%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Programme -->
      <section data-page="programme" class="hidden">
        <section id="program-daily" class="mb-12">
          <h2 class="text-3xl font-bold text-center mb-8 text-[#00A0B0]">Programme D√©taill√© Jour par Jour</h2>
          <div id="program-daily-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
        </section>

        <section id="personal-zikr" class="mb-12">
          <h2 class="text-3xl font-bold text-center mb-8 text-[#00A0B0]">Mes Zikrs Personnalis√©s</h2>
          <div id="personal-zikr-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6"></div>
        </section>

        <section id="zikr-formulas" class="mb-12">
          <h2 class="text-3xl font-bold text-center mb-8 text-[#00A0B0]">Formules de Zikr √† R√©citer</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            <!-- Carte 1: Formule de Taw·∏•ƒ´d -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
              <h3 class="text-xl font-bold text-[#6A4A3C] mb-4">Formule de Taw·∏•ƒ´d</h3>
              <p class="text-gray-600 mb-4">Apr√®s la pri√®re de la nuit du mardi ‚Äì 70 fois</p>
              <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500">
                <p class="arabic-text text-lg text-blue-800">ŸÑŸéÿß ÿ•ŸêŸÑŸéŸ∞ŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéÿ≠ŸíÿØŸéŸáŸè ŸÑŸéÿß ÿ¥Ÿéÿ±ŸêŸäŸÉŸé ŸÑŸéŸáŸèÿå ŸÑŸéŸáŸè ÿßŸÑŸíŸÖŸèŸÑŸíŸÉŸè ŸàŸéŸÑŸéŸáŸè ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸèÿå ŸäŸèÿ≠ŸíŸäŸêŸä ŸàŸéŸäŸèŸÖŸêŸäÿ™Ÿèÿå ŸàŸéŸáŸèŸàŸé ÿ≠ŸéŸäŸåŸë ŸÑŸéÿß ŸäŸéŸÖŸèŸàÿ™Ÿèÿå ÿ∞ŸèŸà ÿßŸÑŸíÿ¨ŸéŸÑŸéÿßŸÑŸê ŸàŸéÿßŸÑŸíÿ•ŸêŸÉŸíÿ±ŸéÿßŸÖŸêÿå ÿ®ŸêŸäŸéÿØŸêŸáŸê ÿßŸÑŸíÿÆŸéŸäŸíÿ±Ÿèÿå ŸàŸéŸáŸèŸàŸé ÿπŸéŸÑŸéŸâŸ∞ ŸÉŸèŸÑŸêŸë ÿ¥ŸéŸäŸíÿ°Ÿç ŸÇŸéÿØŸêŸäÿ±Ÿå.</p>
              </div>
              <p class="text-sm text-gray-500 mt-3">Proclame l'unicit√© de Dieu, sa souverainet√© et Sa puissance absolue.</p>
            </div>

            <!-- Carte 2: Formule du Jeudi Soir -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
              <h3 class="text-xl font-bold text-[#6A4A3C] mb-4">Formule du Jeudi Soir</h3>
              <p class="text-gray-600 mb-4">R√©citer 100 fois</p>
              <div class="bg-yellow-50 p-4 rounded-xl border-l-4 border-yellow-500">
                <p class="arabic-text text-lg text-yellow-800">ŸÑŸéÿß ÿ•ŸêŸÑŸéŸ∞ŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸéŸëŸáŸè ÿßŸÑŸíŸÖŸéŸÑŸêŸÉŸè ÿßŸÑŸíÿ≠ŸéŸÇŸèŸë ÿßŸÑŸíŸÖŸèÿ®ŸêŸäŸÜŸè.</p>
              </div>
              <p class="text-sm text-gray-500 mt-3">¬´ Il n'y a de divinit√© que Dieu, le Roi, le Juste, le Manifeste ¬ª.</p>
            </div>

            <!-- Carte 3: Formule du Vendredi -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
              <h3 class="text-xl font-bold text-[#6A4A3C] mb-4">Formule du Vendredi</h3>
              <p class="text-gray-600 mb-4">Apr√®s la pri√®re entre Dhuhr et  øAsr ‚Äì 50 fois</p>
              <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-orange-500">
                <p class="arabic-text text-lg text-orange-800">ŸÑŸéÿß ÿ≠ŸéŸàŸíŸÑŸé ŸàŸéŸÑŸéÿß ŸÇŸèŸàŸéŸëÿ©Ÿé ÿ•ŸêŸÑŸéŸëÿß ÿ®ŸêÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑŸíÿπŸéŸÑŸêŸäŸêŸë ÿßŸÑŸíÿπŸéÿ∏ŸêŸäŸÖŸê.</p>
              </div>
              <p class="text-sm text-gray-500 mt-3">¬´ Il n'y a de puissance ni de force qu'en Dieu, le Tr√®s-Haut, l'Immense ¬ª.</p>
            </div>
          </div>
        </section>

        <section id="special-invocations" class="mb-12">
          <h2 class="text-3xl font-bold text-center mb-8 text-[#00A0B0]">Pratique des Invocations Sp√©ciales</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Carte 1: Litanie d'amour du Proph√®te Ô∑∫ -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
              <h3 class="text-xl font-bold text-[#6A4A3C] mb-4">Litanie d'amour du Proph√®te Ô∑∫</h3>
              <div class="space-y-4">
                <p class="text-gray-700"><strong>Pour B√©n√©ficier indubitablement de l'Amour du Proph√®te (PSL) source de Salvation et de Saintet√©.</strong></p>
                <p class="text-gray-600">R√©citez 12 fois la Sal√¢toul F√¢th√Æh - suivie du zikr de cette litanie (12 fois).</p>

                <div class="bg-green-50 p-4 rounded-xl border-l-4 border-green-500">
                  <p class="arabic-text text-lg text-green-800 leading-relaxed">ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ŸàŸéÿ£Ÿéÿ™ŸéŸàŸéÿ¨ŸéŸëŸáŸè ÿ•ŸêŸÑŸéŸäŸíŸÉŸé. ÿ®Ÿêÿ≠Ÿéÿ®ŸêŸäÿ®ŸêŸÉŸé ŸàŸéÿ±Ÿéÿ≥ŸèŸàŸÑŸêŸÉŸé ŸàŸéÿ±ŸéŸÅŸêŸäÿπŸê ÿßŸÑŸíŸÇŸéÿØŸíÿ±Ÿê ÿπŸêŸÜŸíÿØŸéŸÉŸé. ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ÿµŸéŸÑŸéŸëŸâ ÿßŸÑŸÑŸéŸëŸáŸè ÿπŸéŸÑŸéŸäŸíŸáŸê ŸàŸéÿ≥ŸéŸÑŸéŸëŸÖŸé. ÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä ŸÖŸéÿ≠Ÿéÿ®ŸéŸëÿ©Ÿã ÿÆŸéÿßÿµŸéŸëÿ©Ÿãÿå ÿÆŸéÿßŸÑŸêÿµŸéÿ©Ÿã ŸÅŸêŸäŸÉŸé. ŸàŸéŸÅŸêŸä ÿ≠Ÿéÿ®ŸêŸäÿ®ŸêŸÉŸé ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç (ÿµŸéŸÑŸéŸëŸâ ÿßŸÑŸÑŸéŸëŸáŸè ÿπŸéŸÑŸéŸäŸíŸáŸê ŸàŸéÿ≥ŸéŸÑŸéŸëŸÖŸé). ŸàŸéÿßÿ¨ŸíÿπŸéŸÑŸíŸÜŸêŸä ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ŸàŸéÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê. ŸÖŸêŸÜŸí ÿ£ŸéŸáŸíŸÑŸê ÿßŸÑŸíŸàŸêŸÑŸéÿßŸäŸéÿ©Ÿê ÿßŸÑŸíÿÆŸéÿßÿµŸéŸëÿ©Ÿê. ŸÉŸéÿßŸÖŸêŸÑŸéÿ©Ÿê ÿßŸÑŸíÿπŸêÿ±ŸíŸÅŸéÿ©Ÿê ÿßŸÑŸéŸëÿ™ŸêŸä ŸÑŸéÿß ÿ¥Ÿéÿßÿ¶Ÿêÿ®Ÿéÿ©Ÿé ŸÅŸêŸäŸáŸéÿß ŸÑŸêÿ∫ŸéŸäŸíÿ±ŸêŸÉŸé. ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÑŸéŸâ ŸÉŸèŸÑŸêŸë ÿ¥ŸéŸäŸíÿ°Ÿç ŸÇŸéÿØŸêŸäÿ±Ÿå</p>
                </div>

                <div class="text-sm text-gray-600 italic leading-relaxed">
                  <p><strong>Traduction :</strong> √î ! Mon Dieu ! je Te Demande et m'Oriente vers Toi par le Biais de Ton Bien-Aim√© et Messager, dont la Gradation est Sublime, notre Seigneur Mouhammad (PSL). Accordes-moi Ton Amour (Particulier), Pur (Agr√©e), par Toi. Ainsi que celui de Ton Bien-Aim√©, notre Seigneur Mouhammad (PSL). Accordes-moi ici-bas et dans l'au-del√† le Privil√®ge de faire Partie de Tes Saints Privil√©gi√©s et Parfaits Exempts de toute Asp√©rit√©. Tu Es certes, sur toute chose le Tout Puissant.</p>
                </div>
              </div>

              <!-- Carte 2: Invocation protectrice avant le sommeil -->
              <div class="bg-white rounded-2xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-[#6A4A3C] mb-4">Invocation protectrice avant le sommeil</h3>
                <div class="space-y-4">
                  <p class="text-gray-700"><strong>Oraison Protectrice et Punitive contre les ennemis et adversaires.</strong></p>
                  <p class="text-gray-600">Op√©rez la nuit avant de vous coucher.</p>

                  <div class="bg-purple-50 p-4 rounded-xl border-l-4 border-purple-500">
                    <h4 class="font-semibold text-purple-800 mb-3">Proc√©dure :</h4>
                    <ol class="list-decimal list-inside space-y-2 text-sm text-purple-700">
                      <li>R√©citez 10 ou 11 fois le Ta'aou√¥z</li>
                      <li>1 Fatiha jusqu'√† "Iyy√¢ka n√¢'boudo√ª wa Iyy√¢ka nas-ta'√Æn"</li>
                      <li>1 Sal√¢toul F√¢tihi</li>
                      <li>Posez la main droite ou gauche sur les yeux</li>
                      <li>Apr√®s le zikr de 6 VT terminer la Fatiha ouvrez les yeux</li>
                      <li>R√©p√©tez 11 fois l'Invocation Suivante :</li>
                    </ol>
                  </div>

                  <div class="bg-red-50 p-4 rounded-xl border-l-4 border-red-500">
                    <p class="arabic-text text-lg text-red-800 leading-relaxed mb-3">ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ÿ±Ÿéÿ®ŸêŸëŸä ŸàŸéÿ±Ÿéÿ®ŸêŸëŸÉŸèŸÖŸí ŸÖŸêŸÜŸí ÿ¥Ÿéÿ±ŸêŸë ŸÉŸèŸÑŸêŸë ŸÖŸèÿ™ŸéŸÉŸéÿ®ŸêŸëÿ±Ÿç ŸÑŸéÿß ŸäŸèÿ§ŸíŸÖŸêŸÜŸè ÿ®ŸêŸäŸéŸàŸíŸÖŸê ÿßŸÑŸíÿ≠Ÿêÿ≥Ÿéÿßÿ®Ÿê</p>
                    <p class="text-sm text-red-700 italic">O! Mon Dieu je me R√©fugie aupr√®s de Toi! Mon Seigneur et Notre Ma√Ætre Absolu contre tout pr√©varicateur plein de gloriole, de surcro√Æt m√©cr√©ant au Jour du Rendement des Comptes.</p>
                  </div>

                  <p class="text-sm text-gray-600">Terminez ensuite la R√©citation de la Fatiha.</p>

                  <div class="bg-amber-50 p-4 rounded-xl border-l-4 border-amber-500">
                    <h4 class="font-semibold text-amber-800 mb-2">NB : Sceau de Salomon (paix et salut sur lui)</h4>
                    <p class="text-sm text-amber-700 mb-2">Si vous √™tes sous l'emprise de l'ensorcellement, de la m√©chancet√©, du mauvais ≈ìil ou des mauvaises langues, il est recommand√© d'utiliser le pentacle suivant :</p>
                    <ol class="list-decimal list-inside space-y-1 text-sm text-amber-700">
                      <li>√âcrivez le Sceau de Salomon trois fois sur des feuilles ou des tablettes</li>
                      <li>Autour du pentacle, √©crivez le Verset du Tr√¥ne (Ayat al-Kursi)</li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- Lectures -->
      <section data-page="lectures" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Lectures Spirituelles</h2>

          <!-- Onglets selon l'ancienne version -->
          <div class="flex flex-wrap gap-3 mb-6" id="lecture-tabs">
            <button
              class="tab-btn px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-300"
              data-lect="kahf"
              aria-pressed="false"
            >
              <div class="flex items-center gap-2">
                <span class="text-lg">üïå</span>
                <div class="text-left">
                  <div class="font-bold">Lecture sp√©ciale Vendredi</div>
                  <div class="text-xs opacity-80">ÿ≥Ÿàÿ±ÿ© ÿßŸÑŸÉŸáŸÅ</div>
                </div>
              </div>
            </button>
            <button
              class="tab-btn px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-300"
              data-lect="special"
            >
              <div class="flex items-center gap-2">
                <span class="text-lg">‚ú®</span>
                <div class="text-left">
                  <div class="font-bold">Lecture Spirituelle Quotidienne</div>
                  <div class="text-xs opacity-80">ÿßŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ±Ÿàÿ≠Ÿäÿ© ÿßŸÑŸäŸàŸÖŸäÿ©</div>
                </div>
              </div>
            </button>
          </div>



          <div id="lect-content" class="max-w-none">
            <div class="text-center py-12">
              <div class="w-16 h-16 bg-gradient-islamic rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                <span class="text-white text-2xl">üìñ</span>
              </div>
              <p class="text-slate-500 text-lg">Choisissez une lecture ci-dessus</p>
              <p class="text-slate-400 text-sm mt-2">ÿßÿÆÿ™ÿ± ŸÇÿ±ÿßÿ°ÿ© ŸÖŸÜ ÿßŸÑÿ£ÿπŸÑŸâ</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Retraite -->
      <section data-page="retraite" class="hidden">
        <div class="space-y-8">
          <!-- Configuration de la Retraite -->
          <div class="card">
            <h2 class="title text-2xl mb-3">Configuration de la Retraite</h2>
            <label class="block text-sm text-slate-600 mb-1"
              >Date de d√©but (4 semaines)</label
            >
            <input
              id="retreat-start"
              type="date"
              class="border rounded-lg px-3 py-2"
            />
            <button
              id="retreat-save"
              class="ml-2 px-3 py-2 rounded-lg bg-emerald-600 text-white"
            >
              Enregistrer
            </button>
            <div id="retreat-msg" class="mt-3 text-slate-600">‚Äî</div>
          </div>

          <!-- Grille Quotidienne -->
          <div class="card">
            <h2 class="title text-2xl mb-4">Grille Quotidienne de Retraite</h2>
            <div id="retreat-grid" class="overflow-x-auto">
              <!-- Contenu g√©n√©r√© dynamiquement -->
            </div>
          </div>

          <!-- Accents par Semaine -->
          <div class="card">
            <h2 class="title text-2xl mb-4">Accents Th√©matiques par Semaine</h2>
            <div id="retreat-weeks" class="grid lg:grid-cols-2 xl:grid-cols-4 gap-4">
              <!-- Contenu g√©n√©r√© dynamiquement -->
            </div>
          </div>

          <!-- Planning Annuel All√©g√© -->
          <div class="card">
            <h2 class="title text-2xl mb-4">Planning Annuel All√©g√©</h2>
            <div id="retreat-annual">
              <!-- Contenu g√©n√©r√© dynamiquement -->
            </div>
          </div>
        </div>
      </section>

      <!-- Journal -->
      <section data-page="journal" class="hidden">
        <div class="space-y-8" id="journal-container">

          <!-- En-t√™te spirituel -->
          <div class="text-center mb-8">
            <h1 class="journal-title">ŸÖŸèÿ∞ŸéŸÉŸêŸëÿ±Ÿéÿ™ŸêŸä ÿßŸÑÿ±ŸèŸëŸàÿ≠ŸêŸäŸéŸëÿ©</h1>
            <p class="text-lg text-muted font-medium">Mon Carnet Spirituel Quotidien</p>
            <div class="mt-4 text-sm text-muted">
              <span class="arabic-text text-base">Ô¥øŸàŸéÿ∞ŸéŸÉŸêŸëÿ±Ÿí ŸÅŸéÿ•ŸêŸÜŸéŸë ÿßŸÑÿ∞ŸêŸëŸÉŸíÿ±ŸéŸâŸ∞ ÿ™ŸéŸÜŸÅŸéÿπŸè ÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸêŸäŸÜŸéÔ¥æ</span>
              <p class="mt-2 italic">"Et rappelle, car le rappel profite aux croyants"</p>
            </div>
          </div>

          <!-- Export/Import des donn√©es modernis√© -->
          <div class="journal-section">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
              </div>
              <h3 class="text-xl font-bold text-slate-800">Sauvegarde des Donn√©es</h3>
            </div>

            <div class="flex flex-wrap gap-4">
              <button
                id="export-data"
                class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl hover:from-blue-600 hover:to-cyan-600 font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                </svg>
                Exporter mes donn√©es
              </button>
              <div class="flex items-center gap-2">
                <input
                  type="file"
                  id="import-file"
                  accept=".json"
                  class="hidden"
                />
                <button
                  id="import-data"
                  class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-emerald-500 to-green-500 text-white rounded-xl hover:from-emerald-600 hover:to-green-600 font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                  </svg>
                  Importer des donn√©es
                </button>
              </div>
            </div>
            <div id="import-status" class="mt-4 text-sm font-medium"></div>
          </div>

          <!-- Suivi des pri√®res modernis√© -->
          <div class="journal-section">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 bg-gradient-islamic rounded-full flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-slate-800">ÿßŸÑÿµŸéŸëŸÑŸéŸàŸéÿßÿ™ ÿßŸÑÿÆŸéŸÖÿ≥</h3>
                <p class="text-muted">Les Cinq Pri√®res Quotidiennes</p>
              </div>
            </div>

            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Fajr" id="prayer-fajr" />
                <label for="prayer-fajr">
                  <div class="flex items-center justify-between w-full">
                    <span class="font-semibold">ÿßŸÑŸÅÿ¨ÿ± - Fajr</span>
                    <span class="text-sm text-muted">Aube</span>
                  </div>
                </label>
              </div>

              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Dhuhr" id="prayer-dhuhr" />
                <label for="prayer-dhuhr">
                  <div class="flex items-center justify-between w-full">
                    <span class="font-semibold">ÿßŸÑÿ∏Ÿáÿ± - Dhuhr</span>
                    <span class="text-sm text-muted">Midi</span>
                  </div>
                </label>
              </div>

              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Asr" id="prayer-asr" />
                <label for="prayer-asr">
                  <div class="flex items-center justify-between w-full">
                    <span class="font-semibold">ÿßŸÑÿπÿµÿ± - Asr</span>
                    <span class="text-sm text-muted">Apr√®s-midi</span>
                  </div>
                </label>
              </div>

              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Maghrib" id="prayer-maghrib" />
                <label for="prayer-maghrib">
                  <div class="flex items-center justify-between w-full">
                    <span class="font-semibold">ÿßŸÑŸÖÿ∫ÿ±ÿ® - Maghrib</span>
                    <span class="text-sm text-muted">Coucher</span>
                  </div>
                </label>
              </div>

              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Isha" id="prayer-isha" />
                <label for="prayer-isha">
                  <div class="flex items-center justify-between w-full">
                    <span class="font-semibold">ÿßŸÑÿπÿ¥ÿßÿ° - Isha</span>
                    <span class="text-sm text-muted">Nuit</span>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- Compteur Tasbih modernis√© -->
          <div class="journal-section">
            <div class="tasbih-section">
              <!-- En-t√™te centr√© -->
              <div class="text-center mb-6">
                <div class="inline-flex items-center gap-3 mb-4">
                  <div class="w-12 h-12 bg-gradient-warm rounded-full flex items-center justify-center shadow-lg">
                    <span class="text-2xl">üìø</span>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-slate-800">ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜ ÿßŸÑŸÑŸëŸáŸê</h3>
                    <p class="text-muted">Compteur de Dhikr</p>
                  </div>
                </div>
              </div>

              <!-- Compteur centr√© -->
              <div class="text-center mb-8">
                <div class="tasbih-counter" id="tasbih-counter-display">0</div>
                <p class="text-muted mt-2">invocations compt√©es</p>
              </div>

              <!-- Bouton principal centr√© -->
              <div class="text-center mb-6">
                <button id="tasbih-counter-btn" class="tasbih-button">
                  <div class="text-center">
                    <div class="text-2xl mb-2">ÿßÿ∞ŸíŸÉŸèÿ±</div>
                    <div class="text-sm opacity-90">Invoquer</div>
                  </div>
                </button>
              </div>

              <!-- Bouton reset centr√© -->
              <div class="text-center">
                <button id="tasbih-reset-btn" class="inline-flex items-center gap-2 text-muted hover:text-red-500 underline transition-colors duration-300">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                  R√©initialiser le compteur
                </button>
              </div>
            </div>
          </div>

          <!-- Notes personnelles modernis√©es -->
          <div class="journal-section">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-slate-800">ŸÖŸèÿ∞ŸéŸÉŸêŸëÿ±Ÿéÿßÿ™ŸêŸä</h3>
                <p class="text-muted">Notes et R√©flexions Personnelles</p>
              </div>
            </div>

            <div class="relative">
              <textarea
                id="note"
                class="notes-textarea"
                placeholder="√âcris ici les pens√©es que ton c≈ìur a retenues aujourd'hui... 

¬´ ŸàŸéŸÇŸèŸÑ ÿ±ŸéŸëÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß ¬ª - Et dis : ¬´ √î mon Seigneur, accrois mes connaissances ! ¬ª

‚ú® Moments de gratitude
ü§≤ Pri√®res exauc√©es  
üìö Enseignements re√ßus
üíù Actes de bont√© accomplis"
              ></textarea>

              <!-- Ornement d√©coratif -->
              <div class="absolute top-4 right-4 text-2xl text-muted opacity-30">
                Ô¥ø€ûÔ¥æ
              </div>
            </div>

            <div class="mt-4 flex items-center justify-between text-sm text-muted">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <span>Vos notes sont automatiquement sauvegard√©es</span>
              </div>
              <div class="arabic-text text-base opacity-60">
                ÿßŸÑÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸëŸáŸê
              </div>
            </div>
          </div>

          <!-- Historique et Progression -->
          <div class="journal-section">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-cyan-500 rounded-full flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-xl font-bold text-slate-800">ÿßŸÑÿ™ŸéŸëÿßÿ±ŸêŸäÿÆ ŸàŸéÿßŸÑÿ™ŸéŸëŸÇŸéÿØŸèŸëŸÖ</h3>
                <p class="text-muted">Historique et Progression Spirituelle</p>
              </div>
            </div>

            <!-- Navigation par date -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-4">
                <h4 class="font-semibold text-slate-800 mb-3">Navigation par Date</h4>
                <div class="space-y-3">
                  <div class="flex items-center gap-2">
                    <label for="journal-date-picker" class="text-sm font-medium text-slate-700">Consulter le :</label>
                    <input 
                      type="date" 
                      id="journal-date-picker" 
                      class="flex-1 border border-slate-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-islamic-green focus:border-islamic-green"
                    />
                  </div>
                  <button 
                    id="journal-load-date-btn" 
                    class="w-full bg-gradient-islamic text-white py-2 px-4 rounded-lg hover:shadow-lg transition-all duration-300"
                  >
                    Charger cette date
                  </button>
                </div>
              </div>

              <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl p-4">
                <h4 class="font-semibold text-slate-800 mb-3">Statistiques Rapides</h4>
                <div class="space-y-2">
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Jours avec notes :</span>
                    <span class="font-bold text-emerald-700" id="stats-notes-count">0</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">S√©rie actuelle :</span>
                    <span class="font-bold text-emerald-700" id="stats-current-streak">0 jours</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-600">Dhikr total :</span>
                    <span class="font-bold text-emerald-700" id="stats-total-dhikr">0</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Historique des 7 derniers jours -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6">
              <h4 class="font-semibold text-slate-800 mb-4">Historique des 7 Derniers Jours</h4>
              <div id="journal-history-grid" class="space-y-4">
                <!-- Contenu g√©n√©r√© dynamiquement -->
              </div>
            </div>

            <!-- Recherche dans les notes -->
            <div class="mt-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6">
              <h4 class="font-semibold text-slate-800 mb-4">Recherche dans les Notes</h4>
              <div class="flex gap-3 mb-4">
                <input 
                  type="text" 
                  id="notes-search-input" 
                  placeholder="Rechercher dans vos r√©flexions..."
                  class="flex-1 border border-slate-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                />
                <button 
                  id="notes-search-btn" 
                  class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg hover:shadow-lg transition-all duration-300"
                >
                  Chercher
                </button>
              </div>
              <div id="notes-search-results" class="space-y-3">
                <!-- R√©sultats de recherche -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mois -->
      <section data-page="mois" class="hidden">
        <div class="space-y-6">
          <!-- Alerte du jour si applicable -->
          <div id="jour-alerte" class="hidden card bg-amber-50 border-amber-200">
            <h3 class="text-lg font-semibold mb-2 text-amber-800">üåü Jour sp√©cial aujourd'hui</h3>
            <div id="jour-alerte-content"></div>
          </div>

          <!-- Mois en cours -->
          <div class="card">
            <h2 class="title text-2xl mb-4">Mois h√©girien en cours</h2>
            <div id="mois-info" class="space-y-4">
              <div class="text-center text-slate-600">Chargement...</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Qibla -->
      <section data-page="qibla" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Direction de la Qibla</h2>
          <div class="qibla-rose">
            <div id="qibla-arrow" class="qibla-arrow" aria-hidden="true"></div>
            <span class="sr-only" id="qibla-angle-label"></span>
          </div>
          <div class="mt-4 flex items-center gap-3">
            <button
              id="btn-geo"
              class="px-3 py-2 rounded-lg bg-slate-800 text-white"
            >
              Utiliser ma position
            </button>
            <div id="qibla-text" class="text-slate-600">
              Par d√©faut : Bobo-Dioulasso
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="mt-12 pb-10 text-center text-slate-500">
      Compagnon spirituel pour faciliter la pratique quotidienne.
    </footer>

    <!-- 1) Service Worker -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("sw.js").catch(console.error);
        });
      }
    </script>

    <!-- 2) Bridge: expose window.storageAPI (via bridge.js) -->
    <script type="module" src="./bridge.js"></script>

    <!-- 3) App Controller (horloge, onglets, pri√®res, charts, qibla) -->
    <script type="module">
      // --- Fallback localStorage ---
      if (!window.storageAPI) {
        window.storageAPI = {
          storageGet: async (key, defVal) => {
            try { const v = localStorage.getItem(key); return v == null ? defVal : JSON.parse(v); }
            catch { return defVal; }
          },
          storageSet: async (key, val) => { localStorage.setItem(key, JSON.stringify(val)); return true; },
          storageRemove: async (key) => { localStorage.removeItem(key); return true; },
          storageSubscribe: (key, cb) => {
            const h = (e) => { if (e.key === key) cb(e.newValue ? JSON.parse(e.newValue) : null); };
            window.addEventListener('storage', h); return () => window.removeEventListener('storage', h);
          }
        };
        console.log('[Compagnon] fallback storage ready');
      }
      // -----------------------------

      // util
      const $ = (s, r = document) => r.querySelector(s);
      const $$ = (s, r = document) => [...r.querySelectorAll(s)];

      // Horloge & Dates
      moment.locale("fr");

      let lastHijriDate = null;

      function tickClock() {
        const now = moment();
        $("#clock").textContent = now.format("HH:mm:ss");
        $("#date-greg").textContent = now.format("dddd D MMMM YYYY");

        // Ne mettre √† jour la date hijri que si elle a chang√©
        const hijriDay = now.iDate();
        const hijriYear = now.iYear();
        const hijriMonthIndex = now.iMonth();

        // Noms des mois hijri en fran√ßais
        const hijriMonthsFr = [
          'Muharram', 'Safar', 'Rabi\' al-awwal', 'Rabi\' al-thani',
          'Jumada al-awwal', 'Jumada al-thani', 'Rajab', 'Sha\'ban',
          'Ramadan', 'Shawwal', 'Dhu al-Qi\'dah', 'Dhu al-Hijjah'
        ];

        const currentHijriDate = `${hijriDay} ${hijriMonthsFr[hijriMonthIndex]} ${hijriYear}`;
        if (currentHijriDate !== lastHijriDate) {
          $("#date-hijri").textContent = currentHijriDate;
          lastHijriDate = currentHijriDate;

          // Mettre √† jour les d√©tails du mois hijri
          updateHijriMonthDetails(now);
        }
      }

      async function updateHijriMonthDetails(now) {
        try {
          const response = await fetch('./data/mois.json');
          if (response.ok) {
            const data = await response.json();
            const currentHijriMonth = now.iMonth();
            const currentMonth = data.mois.find(m => m.i === currentHijriMonth);

            const monthDetailEl = $("#month-detail");
            if (currentMonth && monthDetailEl) {
              // Cr√©er le descriptif avec jours cl√©s et pratiques
              let descriptif = currentMonth.sens;

              // Ajouter les jours cl√©s
              const joursDesc = currentMonth.cles.length > 0
                ? `Jours cl√©s: ${currentMonth.cles.join(', ')}`
                : 'Aucun jour cl√©';

              // Ajouter les pratiques
              const pratiquesDesc = `Pratiques: ${currentMonth.pratiques.join(', ')}`;

              // Combiner tout
              descriptif += ` (${joursDesc}; ${pratiquesDesc})`;

              monthDetailEl.textContent = descriptif;
            }
          }
        } catch (error) {
          console.log('[Hijri] Erreur chargement d√©tails mois:', error);
        }
      }

      tickClock();
      setInterval(tickClock, 1000);

      // Onglets
      const pages = $$("section[data-page]");
      const btns = $$(".tab-btn");
      function show(tab) {
        pages.forEach((p) =>
          p.classList.toggle("hidden", p.dataset.page !== tab),
        );
        btns.forEach((b) =>
          b.setAttribute("aria-selected", String(b.dataset.tab === tab)),
        );
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
      btns.forEach((b) =>
        b.addEventListener("click", () => show(b.dataset.tab)),
      );
      show("accueil");

      // Mode (badge) et retraite - logique compl√®te
      async function refreshRetreat() {
        const api = window.storageAPI;
        if (!api) return;

        const startDate = await api.storageGet("retreatStart", null);
        const modeBadge = $("#mode-badge");
        const retreatMsg = $("#retreat-msg");

        if (!startDate) {
          if (modeBadge) modeBadge.textContent = "Planning Annuel";
          if (retreatMsg) retreatMsg.textContent = "Aucune retraite configur√©e.";
          return;
        }

        const start = moment(startDate);
        const today = moment();
        const diffWeeks = today.diff(start, "weeks");
        const currentWeek = diffWeeks + 1;
        const endDate = start.clone().add(28, "days");

        // Mise √† jour du badge
        if (currentWeek > 4 || today.isAfter(endDate)) {
          if (modeBadge) modeBadge.textContent = "Planning Annuel";
          if (retreatMsg) retreatMsg.textContent = `Retraite termin√©e (${start.format("DD/MM/YYYY")} ‚Üí ${endDate.format("DD/MM/YYYY")})`;
        } else {
          const week = Math.max(1, Math.min(currentWeek, 4));
          if (modeBadge) modeBadge.textContent = `Mode Retraite ‚Äì Semaine ${week}`;
          if (retreatMsg) retreatMsg.textContent = `Retraite en cours : ${start.format("DD/MM/YYYY")} ‚Üí ${endDate.format("DD/MM/YYYY")} (Semaine ${week}/4)`;
        }
      }



      // Charger la date sauvegard√©e dans l'input
      async function loadRetreatDate() {
        const api = window.storageAPI;
        if (!api) return;

        const savedDate = await api.storageGet("retreatStart", null);
        if (savedDate) {
          $("#retreat-start").value = savedDate;
        }
      }

      // Initialiser la retraite
      await refreshRetreat();
      await loadRetreatDate();

      // Retraite: sauvegarder date
      $("#retreat-save").addEventListener("click", async () => {
        const dateValue = $("#retreat-start").value;
        if (!dateValue) {
          $("#retreat-msg").textContent = "Veuillez s√©lectionner une date de d√©but.";
          return;
        }

        const api = window.storageAPI;
        if (!api) return;

        // Sauvegarder avec les deux cl√©s pour compatibilit√©
        await api.storageSet("retreatStart", dateValue);
        localStorage.setItem("retreat_start", dateValue);

        await refreshRetreat();

        // Red√©marrer le syst√®me Focus avec les nouvelles donn√©es
        startFocus();
      });

      // Horaires de pri√®re (Bobo-Dioulasso ‚Äì placeholders statiques pour la d√©mo)
      const PRAYERS = [
        { name: "Fajr", time: "05:00" },
        { name: "Shuruq", time: "06:15" },
        { name: "Dhuhr", time: "12:30" },
        { name: "Asr", time: "15:45" },
        { name: "Maghrib", time: "18:30" },
        { name: "Isha", time: "19:45" },
      ];
      for (const p of PRAYERS) {
        $("#t-" + p.name).textContent = p.time;
      }
      // Tableau de bord spirituel - Mise √† jour des m√©triques
      async function updateDashboard() {
        const api = window.storageAPI;
        if (!api) return;

        const today = moment().format("YYYY-MM-DD");

        try {
          // 1. Compter les pri√®res accomplies aujourd'hui
          const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
          let prayersToday = 0;

          for (const prayer of prayers) {
            const isDone = await api.storageGet(`jp:${today}:${prayer}`, false);
            if (isDone) prayersToday++;
          }

          $("#prayers-today").textContent = prayersToday;
          $("#prayer-fraction").textContent = `${prayersToday}/5`;

          const prayerProgress = (prayersToday / 5) * 100;
          $("#prayer-progress").style.width = `${prayerProgress}%`;

          // 2. R√©cup√©rer le compteur de dhikr
          const dhikrCount = await api.storageGet("tasbihCount", 0);
          $("#dhikr-count").textContent = dhikrCount;

          const dhikrTarget = 100; // Objectif quotidien
          const dhikrProgress = Math.min((dhikrCount / dhikrTarget) * 100, 100);
          $("#dhikr-progress").style.width = `${dhikrProgress}%`;
          $("#dhikr-fraction").textContent = `${dhikrCount}/${dhikrTarget}`;

          // 3. Calculer la s√©rie de jours cons√©cutifs
          let streakDays = await calculateStreak();
          $("#streak-days").textContent = streakDays;

          // 4. Calculer le pourcentage d'accomplissement de la semaine
          let weeklyProgress = await calculateWeeklyProgress();
          $("#weekly-progress").textContent = `${weeklyProgress}%`;

          // 5. Mettre √† jour la progression Coran (simulation)
          const hasReadQuran = Math.random() > 0.3; // Simulation
          if (hasReadQuran) {
            $("#quran-progress").style.width = "100%";
            $("#quran-status").textContent = "Accomplie ‚úì";
          } else {
            $("#quran-progress").style.width = "0%";
            $("#quran-status").textContent = "En attente";
          }

          console.log('[Dashboard] M√©triques mises √† jour');
        } catch (error) {
          console.error('[Dashboard] Erreur:', error);
        }
      }

      // Calculer la s√©rie de jours cons√©cutifs
      async function calculateStreak() {
        const api = window.storageAPI;
        if (!api) return 0;

        let streak = 0;
        let currentDate = moment();

        // V√©rifier les 30 derniers jours maximum
        for (let i = 0; i < 30; i++) {
          const dateStr = currentDate.format("YYYY-MM-DD");
          let dayScore = 0;

          // V√©rifier les pri√®res de ce jour
          const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
          for (const prayer of prayers) {
            const isDone = await api.storageGet(`jp:${dateStr}:${prayer}`, false);
            if (isDone) dayScore++;
          }

          // Un jour est consid√©r√© "r√©ussi" si au moins 3 pri√®res sont faites
          if (dayScore >= 3) {
            streak++;
          } else {
            break; // Arr√™ter la s√©rie
          }

          currentDate.subtract(1, 'day');
        }

        return streak;
      }

      // Calculer le pourcentage d'accomplissement de la semaine
      async function calculateWeeklyProgress() {
        const api = window.storageAPI;
        if (!api) return 0;

        const startOfWeek = moment().startOf('isoWeek');
        const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
        let totalPossible = 0;
        let totalAccomplished = 0;

        for (let i = 0; i < 7; i++) {
          const date = startOfWeek.clone().add(i, 'days');
          const dateStr = date.format("YYYY-MM-DD");

          // Ne compter que les jours d√©j√† pass√©s
          if (date.isSameOrBefore(moment(), 'day')) {
            for (const prayer of prayers) {
              totalPossible++;
              const isDone = await api.storageGet(`jp:${dateStr}:${prayer}`, false);
              if (isDone) totalAccomplished++;
            }
          }
        }

        return totalPossible > 0 ? Math.round((totalAccomplished / totalPossible) * 100) : 0;
      }

      // Initialiser et mettre √† jour le tableau de bord
      updateDashboard();
      setInterval(updateDashboard, 30000); // Mise √† jour toutes les 30 secondes

      // Focus du jour - syst√®me bas√© sur l'ancienne version
      const dailySchedule = [
        { start: "03:00", end: "04:30", name: "Dernier tiers de la nuit", activities: "Tahajjud (2‚Äì8 rak øƒÅt), du øƒÅ' sinc√®re, dhikr profond." },
        { start: "04:30", end: "05:00", name: "Pri√®re du Fajr", activities: "·π¢alƒÅt al‚ÄëFa«ßr et recueillement." },
        { start: "05:00", end: "07:00", name: "Apr√®s al-fa«ßr", activities: "AdhkƒÅr du matin, lecture/m√©morisation du Coran, m√©ditation." },
        { start: "08:00", end: "10:00", name: "Milieu de la matin√©e", activities: "·π¢alƒÅt ad‚Äë·∏åu·∏•ƒÅ (2‚Äì8 rak øƒÅt), √©tude du Coran ou des ·∏•adiths." },
        { start: "10:00", end: "12:30", name: "Journ√©e", activities: "Travaux personnels, ≈ìuvres caritatives, service." },
        { start: "12:30", end: "13:30", name: "Pri√®re du Dhuhr", activities: "·π¢alƒÅt a·∫ì‚Äë·∫íuhr, dhikr et relecture." },
        { start: "14:00", end: "15:30", name: "Apr√®s-midi", activities: "Lecture spirituelle, √©tude des ma√Ætres soufis, repos." },
        { start: "15:30", end: "16:30", name: "Pri√®re de l'Asr", activities: "·π¢alƒÅt al‚Äë øA·π£r, dhikr, marche m√©ditative." },
        { start: "17:00", end: "19:00", name: "Apr√®s al-maghrib", activities: "·π¢alƒÅt al‚ÄëMaghrib, dhikr, salawat sur le Proph√®te." },
        { start: "20:00", end: "21:30", name: "Apr√®s al-'isha'", activities: "·π¢alƒÅt al‚Äë øIshƒÅ æ, dhikr collectif, litanies." },
        { start: "21:30", end: "03:00", name: "Soir et Nuit", activities: "√âtude, repos, protection nocturne (ƒÄyat al‚ÄëKursƒ´, etc.)." }
      ];

      function updateDailyFocus() {
        const currentTime = moment();
        const currentTimeStr = currentTime.format("HH:mm");
        let currentSlot = dailySchedule.find(slot => {
          const start = slot.start;
          const end = slot.end;
          if (start > end) { // Overnight slot
            return (currentTimeStr >= start && currentTimeStr <= "23:59") || (currentTimeStr >= "00:00" && currentTimeStr < end);
          }
          return currentTimeStr >= start && currentTimeStr < end;
        });

        if (currentSlot) {
          $("#daily-focus-time").textContent = `Maintenant (${currentSlot.name})`;
          $("#daily-focus-content").innerHTML = `<p>${currentSlot.activities}</p>`;
        } else {
          $("#daily-focus-time").textContent = "Repos";
          $("#daily-focus-content").innerHTML = `<p>C'est un moment de transition entre les activit√©s planifi√©es.</p>`;
        }

        // Syst√®me de rappels personnalis√©s intelligents
        const dayOfWeek = currentTime.day(); // 0=Sunday, 1=Monday...
        const hijriDay = currentTime.iDate();
        const weeklyFocusContainer = $("#weekly-special-focus");
        let weeklyHTML = '';

        // Rappels personnalis√©s avec boutons d'action
        weeklyHTML += `
          <div class="special-notification" id="daily-istighfar">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="notification-icon bg-gradient-to-r from-gray-400 to-gray-600 text-white">üìø</div>
                <div>
                  <p class="font-bold text-gray-800">Zikr quotidien</p>
                  <p class="text-gray-600">1261√ó IstighfƒÅr</p>
                </div>
              </div>
              <div class="flex gap-2">
                <button onclick="setReminder('istighfar', 30)" class="px-3 py-1 text-xs bg-emerald-100 text-emerald-700 rounded-full hover:bg-emerald-200 transition-colors">
                  Rappel 30min ‚è∞
                </button>
                <button onclick="markAsCompleted('istighfar')" class="px-3 py-1 text-xs bg-green-100 text-green-700 rounded-full hover:bg-green-200 transition-colors">
                  Fait ‚úÖ
                </button>
              </div>
            </div>
          </div>`;

        if (dayOfWeek === 1 || dayOfWeek === 4) { // Monday or Thursday
          weeklyHTML += `
            <div class="special-notification">
              <div class="flex items-center">
                <div class="notification-icon bg-gradient-to-r from-blue-400 to-blue-600 text-white">üåô</div>
                <div>
                  <p class="font-bold text-blue-800">Rappel du jour</p>
                  <p class="text-blue-600">C'est lundi/jeudi, un jour propice au je√ªne sur√©rogatoire.</p>
                </div>
              </div>
            </div>`;
        }
        if (dayOfWeek === 5) { // Friday
          weeklyHTML += `
            <div class="special-notification">
              <div class="flex items-center">
                <div class="notification-icon bg-gradient-to-r from-green-400 to-green-600 text-white">üïå</div>
                <div>
                  <p class="font-bold text-green-800">Rappel du Vendredi</p>
                  <p class="text-green-600">313√ó ·π¢alƒÅt sur le Proph√®te + Du øƒÅ æ pour les d√©funts apr√®s chaque pri√®re</p>
                </div>
              </div>
            </div>`;
        }
        if (hijriDay >= 13 && hijriDay <= 15) {
          weeklyHTML += `
            <div class="special-notification">
              <div class="flex items-center">
                <div class="notification-icon bg-gradient-to-r from-yellow-400 to-yellow-600 text-white">‚≠ê</div>
                <div>
                  <p class="font-bold text-yellow-800">Jours Blancs</p>
                  <p class="text-yellow-600">Nous sommes dans la p√©riode des jours blancs (${hijriDay}e jour), propice au je√ªne.</p>
                </div>
              </div>
            </div>`;
        }

        // Nuit du mercredi (Hasbunallah)
        const isWednesdayNight = (dayOfWeek === 3 && currentTimeStr >= "19:00") || (dayOfWeek === 4 && currentTimeStr < "04:30");
        if (isWednesdayNight) {
          weeklyHTML += `
            <div class="special-notification">
              <div class="flex items-center">
                <div class="notification-icon bg-gradient-to-r from-purple-400 to-purple-600 text-white">‚ú®</div>
                <div>
                  <p class="font-bold text-purple-800">Nuit du mercredi</p>
                  <p class="text-purple-600">450√ó ·∏§asbunallƒÅh wa ni ømal-wakƒ´l</p>
                </div>
              </div>
            </div>`;
        }

        weeklyFocusContainer.innerHTML = weeklyHTML;
      }

      // Helper pour cr√©er une date "aujourd'hui" √† partir de HH:mm
      function todayAt(hhmm) {
        const [H, M] = hhmm.split(":").map(Number);
        return moment().clone().hours(H).minutes(M).seconds(0).milliseconds(0);
      }

      function nextPrayer() {
        const now = moment();
        for (const p of PRAYERS) {
          const t = todayAt(p.time);
          if (now.isBefore(t)) return { p, t };
        }
        return { p: PRAYERS[0], t: todayAt(PRAYERS[0].time).add(1, 'day') };
      }

      function updateCountdown() {
        const { p, t } = nextPrayer();
        $("#next-prayer-name").textContent = p.name;

        const now = moment();
        const diffMs = t.diff(now);

        // S'assurer que le temps restant est positif
        if (diffMs > 0) {
          const totalSeconds = Math.floor(diffMs / 1000);
          const hours = Math.floor(totalSeconds / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;

          const hh = String(hours).padStart(2, "0");
          const mm = String(minutes).padStart(2, "0");
          const ss = String(seconds).padStart(2, "0");

          $("#next-prayer-eta").textContent = `${hh}:${mm}:${ss}`;
        } else {
          // Si le temps est √©coul√©, afficher 00:00:00 et recalculer
          $("#next-prayer-eta").textContent = "00:00:00";
        }

        // surbrillance
        PRAYERS.forEach((x) => {
          const el = $("#p-" + x.name);
          if (el) {
            el.classList.toggle("ring", x.name === p.name);
            el.classList.toggle("ring-emerald-500", x.name === p.name);
            el.classList.toggle("ring-offset-2", x.name === p.name);
          }
        });
      }

      // updateCountdown est maintenant appel√© dans tick()
      updateCountdown();

      // Journal - fonctions utilitaires et d'initialisation
      let journalInitialized = false;

      async function loadJournalData() {
        const api = window.storageAPI;
        if (!api) return;

        try {
          const today = moment().format("YYYY-MM-DD");

          // Charger le compteur tasbih
          const $count = $("#tasbih-counter-display");
          if ($count) {
            const count = await api.storageGet("tasbihCount", 0);
            $count.textContent = count;
          }

          // Charger les cases de pri√®res (individuellement)
          const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
          for (const prayer of prayers) {
            const checkbox = $(`input.jp[value="${prayer}"]`);
            if (checkbox) {
              const isChecked = await api.storageGet(`jp:${today}:${prayer}`, false);
              checkbox.checked = isChecked;
            }
          }

          // Charger la note du jour
          const $note = $("#note");
          if ($note) {
            const noteContent = await api.storageGet(`note:${today}`, "");
            $note.value = noteContent;
          }

          // Charger les cases Du øƒÅ æ al-Mayyit si vendredi
          if (isFriday(moment())) {
            await loadMayyitCases(today);
          }

          console.log('[Journal] Donn√©es charg√©es avec succ√®s');
        } catch (error) {
          console.error("[Journal] Erreur lors du chargement:", error);
        }
      }

      async function loadMayyitCases(today) {
        const api = window.storageAPI;
        if (!api) return;

        const prayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
        for (const prayer of prayers) {
          const checkbox = $(`#mayyit-${prayer}`);
          if (checkbox) {
            const isChecked = await api.storageGet(`zikrDone:${today}:mayyit${prayer}`, false);
            checkbox.checked = isChecked;
          }
        }
      }

      function setupJournalEventListeners() {
        // Event listeners pour le tasbih avec garde-fous
        const $tasbihBtn = $("#tasbih-counter-btn");
        const $tasbihReset = $("#tasbih-reset-btn");
        const $tasbihValue = $("#tasbih-counter-display");

        if ($tasbihBtn) {
          $tasbihBtn.addEventListener("click", async () => {
            let currentCount = parseInt($tasbihValue.textContent || '0', 10);
            currentCount++;
            $tasbihValue.textContent = currentCount;
            const api = window.storageAPI;
            if (api) await api.storageSet("tasbihCount", currentCount);
          });
        }

        if ($tasbihReset) {
          $tasbihReset.addEventListener("click", async () => {
            $tasbihValue.textContent = '0';
            const api = window.storageAPI;
            if (api) await api.storageSet("tasbihCount", 0);
          });
        }

        // Event listeners pour les cases de pri√®res (individuelles)
        const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
        prayers.forEach(prayer => {
          const checkbox = $(`input.jp[value="${prayer}"]`);
          if (checkbox) {
            checkbox.addEventListener("change", async () => {
              const api = window.storageAPI;
              if (api) {
                const today = moment().format("YYYY-MM-DD");
                await api.storageSet(`jp:${today}:${prayer}`, checkbox.checked);
              }
            });
          }
        });

        // Event listener pour la note
        const $note = $("#note");
        if ($note) {
          $note.addEventListener("input", async () => {
            const api = window.storageAPI;
            if (api) {
              const today = moment().format("YYYY-MM-DD");
              await api.storageSet(`note:${today}`, $note.value);
            }
          });
        }

        // Event listeners pour les cases Du øƒÅ æ al-Mayyit
        const mayyitPrayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
        mayyitPrayers.forEach((prayer) => {
          const checkbox = $(`#mayyit-${prayer}`);
          if (checkbox) {
            checkbox.addEventListener("change", async () => {
              const api = window.storageAPI;
              if (api) {
                const today = moment().format("YYYY-MM-DD");
                await api.storageSet(`zikrDone:${today}:mayyit${prayer}`, checkbox.checked);
              }
            });
          }
        });
      }

      async function initJournal() {
        if (journalInitialized) return;

        if (!window.storageAPI) {
          setTimeout(initJournal, 100);
          return;
        }

        try {
          // Ajouter la section Du øƒÅ æ al-Mayyit si vendredi
          if (isFriday(moment())) {
            addMayyitSection();
          }

          setupJournalEventListeners();
          setupExportImportListeners();
          await loadJournalData();
          journalInitialized = true;
          console.log('[Journal] Initialisation r√©ussie');
        } catch (error) {
          console.error('[Journal] Erreur d\'initialisation:', error);
        }
      }

      function addMayyitSection() {
        const journalContainer = $('#journal-container');
        if (!journalContainer || $("#journal-zikr")) return;

        const mayyitHtml = `
          <div class="card" id="journal-zikr">
            <h3 class="font-semibold mb-2">Du øƒÅ æ al-Mayyit (Vendredi)</h3>
            <div class="grid grid-cols-2 gap-2 text-sm">
              <label class="flex items-center gap-2">
                <input type="checkbox" class="form-checkbox" id="mayyit-fajr">
                <span>Fajr</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" class="form-checkbox" id="mayyit-dhuhr">
                <span>·∫íuhr</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" class="form-checkbox" id="mayyit-asr">
                <span> øA·π£r</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" class="form-checkbox" id="mayyit-maghrib">
                <span>Maghrib</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" class="form-checkbox" id="mayyit-isha">
                <span> øIshƒÅ æ</span>
              </label>
            </div>
          </div>
        `;

        journalContainer.insertAdjacentHTML('beforeend', mayyitHtml);
      }

      // Initialisation au chargement de la page et √† l'ouverture de l'onglet
      document.addEventListener("DOMContentLoaded", initJournal);

      // Fonctions Export/Import des donn√©es - Version robuste
      async function exportUserData() {
        const api = window.storageAPI;
        if (!api) {
          showImportStatus("Erreur : API de stockage non disponible", "error");
          return;
        }

        try {
          const prefixes = ['tasbihCount', 'retreatStart', 'jp:', 'note:', 'zikrDone:', 'mayyit:'];
          const exportData = {
            metadata: {
              exportDate: moment().toISOString(),
              appVersion: "1.0.0",
              dataVersion: "1.0"
            },
            data: {}
          };
          let exportCount = 0;

          // M√©thode robuste : utiliser storageAPI pour r√©cup√©rer les donn√©es
          const allKeys = [];

          // Parcourir localStorage pour identifier les cl√©s
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && prefixes.some(prefix => key.startsWith(prefix))) {
              allKeys.push(key);
            }
          }

          // Utiliser l'API unifi√©e pour r√©cup√©rer chaque valeur
          for (const key of allKeys) {
            try {
              const value = await api.storageGet(key, null);
              if (value !== null) {
                exportData.data[key] = value;
                exportCount++;
              }
            } catch (e) {
              console.warn(`Impossible d'exporter la cl√© ${key}:`, e);
            }
          }

          // Validation avant export
          if (exportCount === 0) {
            showImportStatus("‚ö†Ô∏è Aucune donn√©e √† exporter", "warning");
            return;
          }

          // Cr√©er et t√©l√©charger le fichier
          const dataStr = JSON.stringify(exportData, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });

          const link = document.createElement('a');
          link.href = URL.createObjectURL(dataBlob);
          link.download = `compagnon-spirituel-${moment().format('YYYY-MM-DD-HHmm')}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          showImportStatus(`‚úÖ ${exportCount} entr√©es export√©es avec succ√®s`, "success");
        } catch (error) {
          console.error('[Export] Erreur:', error);
          showImportStatus("‚ùå Erreur lors de l'export", "error");
        }
      }

      async function importUserData(file) {
        const api = window.storageAPI;
        if (!api) {
          showImportStatus("Erreur : API de stockage non disponible", "error");
          return;
        }

        try {
          const text = await file.text();
          let importData = JSON.parse(text);

          // Validation du format de fichier
          if (typeof importData !== 'object' || importData === null) {
            throw new Error('Format de fichier invalide');
          }

          // Support des anciens formats d'export (r√©trocompatibilit√©)
          let dataToImport = {};
          if (importData.metadata && importData.data) {
            // Nouveau format avec metadata
            console.log('[Import] Format avec metadata d√©tect√©:', importData.metadata);
            dataToImport = importData.data;
          } else {
            // Ancien format direct
            console.log('[Import] Format direct d√©tect√©');
            dataToImport = importData;
          }

          const prefixes = ['tasbihCount', 'retreatStart', 'jp:', 'note:', 'zikrDone:', 'mayyit:'];
          let importCount = 0;
          let skippedCount = 0;
          let errorCount = 0;

          // Demander confirmation pour l'import
          const confirmImport = confirm(`Voulez-vous importer ${Object.keys(dataToImport).length} entr√©es ? Cette action remplacera vos donn√©es existantes.`);
          if (!confirmImport) {
            showImportStatus("‚ùå Import annul√© par l'utilisateur", "warning");
            return;
          }

          for (const [key, value] of Object.entries(dataToImport)) {
            // V√©rifier que la cl√© correspond aux pr√©fixes autoris√©s
            if (prefixes.some(prefix => key.startsWith(prefix))) {
              try {
                // Validation basique de la valeur
                if (value === undefined) {
                  console.warn(`Valeur undefined pour la cl√© ${key}, ignor√©e`);
                  skippedCount++;
                  continue;
                }

                await api.storageSet(key, value);
                importCount++;
              } catch (e) {
                console.error(`Impossible d'importer la cl√© ${key}:`, e);
                errorCount++;
              }
            } else {
              skippedCount++;
            }
          }

          // Affichage du r√©sultat d√©taill√©
          let statusMessage = `‚úÖ ${importCount} entr√©es import√©es`;
          if (skippedCount > 0) statusMessage += `, ${skippedCount} ignor√©es`;
          if (errorCount > 0) statusMessage += `, ${errorCount} erreurs`;

          showImportStatus(statusMessage, importCount > 0 ? "success" : "warning");

          // Recharger la page seulement si des donn√©es ont √©t√© import√©es
          if (importCount > 0) {
            setTimeout(() => {
              window.location.reload();
            }, 2000);
          }

        } catch (error) {
          console.error('[Import] Erreur:', error);
          if (error.name === 'SyntaxError') {
            showImportStatus("‚ùå Fichier JSON invalide ou corrompu", "error");
          } else if (error.message.includes('Format de fichier invalide')) {
            showImportStatus("‚ùå Format de fichier non reconnu", "error");
          } else {
            showImportStatus("‚ùå Erreur technique lors de l'import", "error");
          }
        }
      }

      function showImportStatus(message, type) {
        const statusEl = $("#import-status");
        if (!statusEl) return;

        statusEl.textContent = message;

        // Styles selon le type
        const styles = {
          success: 'text-green-600 bg-green-50 border border-green-200',
          error: 'text-red-600 bg-red-50 border border-red-200',
          warning: 'text-orange-600 bg-orange-50 border border-orange-200',
          info: 'text-blue-600 bg-blue-50 border border-blue-200'
        };

        statusEl.className = `mt-4 text-sm p-3 rounded-lg ${styles[type] || styles.info}`;

        // Effacer le message apr√®s 8 secondes (plus long pour lire)
        setTimeout(() => {
          statusEl.textContent = '';
          statusEl.className = 'mt-4 text-sm';
        }, 8000);
      }

      // Event listeners pour Export/Import
      function setupExportImportListeners() {
        const exportBtn = $("#export-data");
        const importBtn = $("#import-data");
        const importFile = $("#import-file");

        if (exportBtn) {
          exportBtn.addEventListener("click", exportUserData);
        }

        if (importBtn) {
          importBtn.addEventListener("click", () => {
            if (importFile) importFile.click();
          });
        }

        if (importFile) {
          importFile.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
              importUserData(file);
              // R√©initialiser l'input pour permettre la s√©lection du m√™me fichier
              e.target.value = '';
            }
          });
        }
      }





      // Syst√®me de lectures arabes avec drop-in files
      /*
      DOCUMENTATION: Ajouter une nouvelle sourate
      ============================================
      1. Cr√©er un fichier JSON dans data/lectures/ avec le nom : surah-XX-name.ar.json
         Format: { "ayahs": [{"n":1,"ar":"ŸÜÿµ ÿßŸÑÿ¢Ÿäÿ©"}, {"n":2,"ar":"ŸÜÿµ ÿßŸÑÿ¢Ÿäÿ©"}] }

      2. Ajouter une entr√©e dans data/lectures/manifest.json :
         "cle": { "title":"ÿßÿ≥ŸÖ ÿßŸÑÿ≥Ÿàÿ±ÿ©", "file":"surah-XX-name.ar.json" }

      3. L'application d√©tectera automatiquement la nouvelle sourate
      */

      let availableSurahs = {};
      let currentSurahData = null;

      // Charger le manifeste des sourates disponibles
      async function loadSurahManifest() {
        try {
          const response = await fetch('./data/lectures/manifest.json');
          if (!response.ok) throw new Error(`Erreur ${response.status}`);

          const manifestData = await response.json();
          if (!manifestData || typeof manifestData !== 'object') {
            throw new Error('Manifeste invalide');
          }

          availableSurahs = manifestData;
          console.log('[Lectures] Manifeste charg√©:', Object.keys(availableSurahs).length, 'sourates');
        } catch (error) {
          console.error('[Lectures] Erreur manifeste:', error);
          const selectEl = $("#surah-select");
          if (selectEl) {
            selectEl.innerHTML = '<option value="">ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©</option>';
          }
        }
      }

      // Remplir le s√©lecteur de sourates (appel√© seulement quand le s√©lecteur existe)
      function populateSurahSelector() {
        const select = $("#surah-select");
        if (!select) {
          // Ne pas afficher d'avertissement car c'est normal si le contenu sp√©cial n'est pas encore rendu
          return false;
        }

        let html = '<option value="">‚Äî S√©lectionnez une sourate ‚Äî</option>';

        // Mapping des noms fran√ßais pour les sourates
        const frenchNames = {
          'fatiha': 'Al-Fatiha (L\'Ouverture)',
          'kahf': 'Al-Kahf (La Caverne)',
          'yasin': 'Ya-Sin',
          'dukhan': 'Ad-Dukhan (La Fum√©e)',
          'waqiah': 'Al-Waqiah (L\'√âv√©nement)',
          'mulk': 'Al-Mulk (La Royaut√©)',
          'insan': 'Al-Insan (L\'Homme)',
          'buruj': 'Al-Buruj (Les Constellations)'
        };

        if (availableSurahs && typeof availableSurahs === 'object') {
          Object.entries(availableSurahs).forEach(([key, surah]) => {
            if (surah && surah.title) {
              const frenchName = frenchNames[key] || key;
              html += `<option value="${key}">${frenchName} - ${surah.title}</option>`;
            }
          });
        }

        select.innerHTML = html;
        return true;
      }

      // Convertit 123 -> Ÿ°Ÿ¢Ÿ£
      function toArabicDigits(n){
        return String(n).replace(/\d/g, d => 'Ÿ†Ÿ°Ÿ¢Ÿ£Ÿ§Ÿ•Ÿ¶ŸßŸ®Ÿ©'[d]);
      }

      // Rendu mushaf : titre + basmala + bloc justifi√© avec pastilles
      function renderSurahMushaf(container, data, title){
        if(!container || !data || !Array.isArray(data.ayahs)) return;

        const showBasmala = (data.surah !== 9); // pas de basmala en sourate 9

        const htmlAyahs = data.ayahs
          .map(a => `${a.ar}<span class="ayah-badge">${toArabicDigits(a.n || a.numberInSurah || a.number || 0)}</span>`)
          .join(' ');

        container.innerHTML = `
          <div id="surah-wrap">
            <div id="surah-title">${title}</div>
            ${showBasmala ? '<span class="bismillah">Ô∑Ω</span>' : ''}
            <p class="ayahs-block" dir="rtl" lang="ar">${htmlAyahs}</p>
          </div>
        `;
      }

      // Charger une sourate sp√©cifique
      async function loadSurah(surahKey) {
        const contentEl = $("#lect-content");

        try {
          // Affichage du chargement
          contentEl.innerHTML = `
            <div class="text-center py-8">
              <div class="animate-spin inline-block w-8 h-8 border-4 border-current border-t-transparent text-slate-600 rounded-full mb-4"></div>
              <p class="text-slate-600">Chargement en cours...</p>
              <p class="text-slate-400 text-sm mt-1">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
            </div>
          `;

          const surah = availableSurahs[surahKey];
          if (!surah) throw new Error('Sourate non trouv√©e');

          const response = await fetch(`./data/lectures/${surah.file}?v=${Date.now()}`);
          if (!response.ok) throw new Error(`Erreur ${response.status}`);

          currentSurahData = await response.json();
          renderSurahMushaf(contentEl, currentSurahData, surah.title);
          console.log('[Lectures] Sourate charg√©e:', surah.title);
        } catch (error) {
          console.error('[Lectures] Erreur chargement sourate:', error);
          contentEl.innerHTML = `
            <div class="text-red-600 p-6 rounded-xl bg-red-50 text-center border border-red-200">
              <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-red-600 text-xl">‚ö†Ô∏è</span>
              </div>
              <p class="font-semibold text-red-800 mb-2">Erreur de chargement</p>
              <p class="text-red-600">Impossible de charger cette sourate</p>
              <p class="text-red-500 text-sm mt-2">ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ≠ŸÖŸäŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿ≥Ÿàÿ±ÿ©</p>
            </div>
          `;
        }
      }

      // Charger le contenu sp√©cial quotidien (conserv√© de l'ancien syst√®me)
      async function loadSpecialContent() {
        try {
          const response = await fetch('./data/special.json');
          if (!response.ok) throw new Error(`Erreur ${response.status}`);

          const data = await response.json();
          renderSpecialContent(data);
        } catch (error) {
          console.error('[Lectures] Erreur contenu sp√©cial:', error);
          $("#lect-content").innerHTML = `
            <div class="text-red-600 p-4 rounded-xl bg-red-50">
              <p><strong>Erreur de chargement</strong></p>
              <p>Impossible de charger le contenu sp√©cial.</p>
            </div>
          `;
        }
      }

      // Rendre le contenu sp√©cial quotidien avec s√©lecteur de sourates
      function renderSpecialContent() {
        const contentEl = $("#lect-content");
        if (!contentEl) {
          console.warn('[Lectures] Conteneur de lectures non trouv√©');
          return;
        }

        // Cr√©er la liste des sourates disponibles (toutes sauf Al-Kahf)
        const availableSurahsForSpecial = availableSurahs && typeof availableSurahs === 'object'
          ? Object.entries(availableSurahs)
              .filter(([key]) => key !== 'kahf')
              .map(([key, surah]) => {
                const frenchNames = {
                  'fatiha': 'Al-Fatiha (L\'Ouverture)',
                  'yasin': 'Ya-Sin',
                  'dukhan': 'Ad-Dukhan (La Fum√©e)',
                  'waqiah': 'Al-Waqiah (L\'√âv√©nement)',
                  'mulk': 'Al-Mulk (La Royaut√©)',
                  'insan': 'Al-Insan (L\'Homme)',
                  'buruj': 'Al-Buruj (Les Constellations)'
                };
                return { key, surah, frenchName: frenchNames[key] || key };
              })
          : [];

        let html = `
          <div class="mb-6">
            <h3 class="text-2xl font-semibold mb-2 title">Lecture Spirituelle Quotidienne</h3>
            <p class="text-slate-600 mb-4">S√©lectionnez une sourate parmi les lectures recommand√©es pour votre pratique spirituelle quotidienne.</p>
          </div>

          <div class="mb-6">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-10 h-10 bg-gradient-islamic rounded-full flex items-center justify-center shadow-lg">
                <span class="text-white text-lg">üìö</span>
              </div>
              <div>
                <h4 class="font-semibold text-slate-800">Sourates recommand√©es</h4>
                <p class="text-sm text-slate-600">Choisissez votre lecture spirituelle</p>
              </div>
            </div>
            <select id="special-surah-select" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 text-lg font-medium focus:border-islamic-green focus:ring-4 focus:ring-emerald-100 transition-all duration-300">
              <option value="">‚Äî S√©lectionnez une sourate ‚Äî</option>
        `;

        availableSurahsForSpecial.forEach(({ key, surah, frenchName }) => {
          html += `<option value="${key}">${frenchName} - ${surah.title}</option>`;
        });

        html += `
            </select>
          </div>

          <div id="special-surah-content">
            <div class="text-center py-12">
              <div class="w-16 h-16 bg-gradient-islamic rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                <span class="text-white text-2xl">üìñ</span>
              </div>
              <p class="text-slate-500 text-lg">Choisissez une sourate ci-dessus</p>
              <p class="text-slate-400 text-sm mt-2">ÿßÿÆÿ™ÿ± ÿ≥Ÿàÿ±ÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ£ÿπŸÑÿßŸá</p>
            </div>
          </div>
        `;

        contentEl.innerHTML = html;

        // Maintenant que le s√©lecteur existe, le remplir avec les sourates
        populateSurahSelector();

        // Ajouter l'event listener pour la s√©lection
        const specialSelect = $("#special-surah-select");
        if (specialSelect) {
          specialSelect.addEventListener('change', (e) => {
            const selectedSurah = e.target.value;
            const contentContainer = $("#special-surah-content");

            if (!contentContainer) {
              console.warn('[Lectures] Conteneur de contenu sp√©cial non trouv√©');
              return;
            }

            if (selectedSurah) {
              // Afficher un √©tat de chargement
              contentContainer.innerHTML = `
                <div class="text-center py-8">
                  <div class="animate-spin inline-block w-8 h-8 border-4 border-current border-t-transparent text-slate-600 rounded-full mb-4"></div>
                  <p class="text-slate-600">Chargement en cours...</p>
                </div>
              `;

              // Charger la sourate s√©lectionn√©e
              loadSurahForSpecial(selectedSurah, contentContainer);
            } else {
              contentContainer.innerHTML = `
                <div class="text-center py-12">
                  <div class="w-16 h-16 bg-gradient-islamic rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <span class="text-white text-2xl">üìñ</span>
                  </div>
                  <p class="text-slate-500 text-lg">Choisissez une sourate ci-dessus</p>
                  <p class="text-slate-400 text-sm mt-2">ÿßÿÆÿ™ÿ± ÿ≥Ÿàÿ±ÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿ£ÿπŸÑÿßŸá</p>
                </div>
              `;
            }
          });
        }
      }

      // Charger une sourate pour la section sp√©ciale
      async function loadSurahForSpecial(surahKey, container) {
        try {
          const surah = availableSurahs[surahKey];
          if (!surah) throw new Error('Sourate non trouv√©e');

          const response = await fetch(`./data/lectures/${surah.file}?v=${Date.now()}`);
          if (!response.ok) throw new Error(`Erreur ${response.status}`);

          const surahData = await response.json();
          renderSurahMushaf(container, surahData, surah.title);
        } catch (error) {
          console.error('[Lectures Special] Erreur chargement sourate:', error);
          container.innerHTML = `
            <div class="text-red-600 p-6 rounded-xl bg-red-50 text-center border border-red-200">
              <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-red-600 text-xl">‚ö†Ô∏è</span>
              </div>
              <p class="font-semibold text-red-800 mb-2">Erreur de chargement</p>
              <p class="text-red-600">Impossible de charger cette sourate</p>
            </div>
          `;
        }
      }

      // Gestion des onglets de lectures
      function setupLecturesTabs() {
        console.log('[Lectures] Configuration des onglets...');

        // Handler d'√©v√©nement unifi√©
        function handleLectureClick(e) {
          e.preventDefault();
          e.stopPropagation();

          const btn = e.currentTarget;
          const lectureType = btn.dataset.lect;

          console.log('[Lectures] Clic d√©tect√© sur:', lectureType);

          // Mise √† jour visuelle des boutons
          $$('[data-lect]').forEach(b => {
            b.setAttribute('aria-pressed', 'false');
            b.classList.remove('bg-gradient-to-r', 'from-emerald-500', 'to-green-500', 'text-white');
          });

          btn.setAttribute('aria-pressed', 'true');
          btn.classList.add('bg-gradient-to-r', 'from-emerald-500', 'to-green-500', 'text-white');

          if (lectureType === 'kahf') {
            console.log('[Lectures] Chargement Al-Kahf');
            loadSurah('kahf');
          } else if (lectureType === 'special') {
            console.log('[Lectures] Chargement contenu sp√©cial');
            renderSpecialContent();
          }
        }

        // Fonction pour attacher les √©v√©nements de mani√®re plus robuste
        function attachEvents() {
          const lectureButtons = $$('[data-lect]');
          console.log('[Lectures] Boutons trouv√©s:', lectureButtons.length);

          if (lectureButtons.length === 0) {
            console.warn('[Lectures] Aucun bouton trouv√©, nouvelle tentative...');
            setTimeout(attachEvents, 100);
            return;
          }

          lectureButtons.forEach((btn, index) => {
            // Cloner et remplacer l'√©l√©ment pour supprimer tous les anciens listeners
            const newBtn = btn.cloneNode(true);
            btn.parentNode.replaceChild(newBtn, btn);

            // Ajouter le nouveau listener sur l'√©l√©ment clon√©
            newBtn.addEventListener('click', handleLectureClick);

            console.log(`[Lectures] Event listener attach√© au bouton ${index + 1}:`, newBtn.dataset.lect);
          });
        }

        // D√©marrer l'attachement
        attachEvents();
      }

      // Charger les lectures lors de l'ouverture de l'onglet
      async function initLectures() {
        console.log('[Lectures] D√©but de l\'initialisation...');

        try {
          await loadSurahManifest();
          console.log('[Lectures] Manifeste charg√©');

          // Observer pour d√©tecter quand les √©l√©ments sont pr√™ts
          const observer = new MutationObserver(() => {
            const lectureButtons = $$('[data-lect]');
            if (lectureButtons.length > 0) {
              observer.disconnect();

              setupLecturesTabs();

              // √âtat initial apr√®s un court d√©lai
              setTimeout(() => {
                const kahfBtn = $('[data-lect="kahf"]');
                if (kahfBtn) {
                  kahfBtn.setAttribute('aria-pressed', 'true');
                  kahfBtn.classList.add('bg-gradient-to-r', 'from-emerald-500', 'to-green-500', 'text-white');
                  loadSurah('kahf');
                  console.log('[Lectures] √âtat initial Al-Kahf configur√©');
                }
              }, 50);
            }
          });

          observer.observe(document.body, { childList: true, subtree: true });

          // Fallback timeout
          setTimeout(() => {
            observer.disconnect();
            setupLecturesTabs();
          }, 2000);

          console.log('[Lectures] Initialisation termin√©e');
        } catch (error) {
          console.error('[Lectures] Erreur d\'initialisation:', error);
        }
      }

      // Helpers pour les zikrs (simplifi√©s, maintenant int√©gr√©s dans le nouveau syst√®me Focus)
      function isFriday(now) {
        return now.isoWeekday() === 5; // 5 = vendredi
      }

      function isWedNight(now) {
        const hour = now.hour();
        const isWednesday = now.isoWeekday() === 3 && hour >= 18; // Mercredi apr√®s 18h
        const isThursday = now.isoWeekday() === 4 && hour < 4; // Jeudi avant 4h
        return isWednesday || isThursday;
      }

      // todayItems maintenant remplac√© par le syst√®me Focus dynamique
      async function todayItems(now) {
        // Fonction conserv√©e pour compatibilit√© mais remplac√©e par renderFocus
        return [];
      }

      // Donn√©es des zikrs personnalis√©s
      const personalZikr = [
        {
          id: 'istighfar',
          title: 'IstighfƒÅr Quotidien',
          count: 1261,
          periodicity: 'Tous les jours',
          arabic: 'ÿ£ÿ≥ÿ™ÿ∫ŸÅÿ±Ÿè ÿßŸÑŸÑŸá',
          condition: 'daily'
        },
        {
          id: 'salat-prophet',
          title: '·π¢alƒÅt sur le Proph√®te (Ô∑∫)',
          count: 313,
          periodicity: 'Chaque vendredi',
          arabic: 'ÿßŸÑŸÑŸáŸÖ ÿµŸÑŸêŸë ÿπŸÑŸâ ÿ≥ŸäÿØŸêŸÜÿß ŸÖÿ≠ŸÖÿØŸç ŸàÿπŸÑŸâ ÿ¢ŸÑŸá Ÿàÿµÿ≠ÿ®Ÿá Ÿàÿ≥ŸÑŸÖ',
          condition: 'friday'
        },
        {
          id: 'hasbunallah',
          title: 'Hasbunallah',
          count: 450,
          periodicity: 'Chaque mercredi (nuit)',
          arabic: 'ÿ≠Ÿéÿ≥Ÿíÿ®ŸèŸÜŸéÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéŸÜŸêÿπŸíŸÖŸé ÿßŸÑŸíŸàŸéŸÉŸêŸäŸÑŸè',
          condition: 'wednesday'
        },
        {
          id: 'dua-defunts',
          title: 'Du øƒÅ pour les d√©funts',
          periodicity: 'Apr√®s chaque pri√®re du vendredi',
          arabic: 'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸêŸäŸÜŸé ŸàŸéÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸéÿßÿ™Ÿê ÿßŸÑÿ£Ÿéÿ≠ŸíŸäŸéÿßÿ°Ÿê ŸÖŸêŸÜŸíŸáŸèŸÖŸí ŸàŸéÿßŸÑÿ£ŸéŸÖŸíŸàŸéÿßÿ™Ÿê',
          condition: 'friday-every-prayer'
        }
      ];

      // Programme quotidien d√©taill√©
      const dailyProgram = [
        {
          day: 'Dimanche',
          night: '4 rak øat (1 FƒÅti·∏•a + 3 IkhlƒÅ·π£) | Zikr : 70 IstighfƒÅr.',
          day_content: '4 rak øat (1 FƒÅti·∏•a + 1 KƒÅfir≈´n) | Zikr : 10 IkhlƒÅ·π£.'
        },
        {
          day: 'Lundi',
          night: '2 rak øat (1 FƒÅti·∏•a + 15 ƒÄyat al-Kursƒ´ + 1 IkhlƒÅ·π£ + 1 Falaq + 1 NƒÅs).',
          day_content: '2 rak øat (1 FƒÅti·∏•a + 1 ƒÄyat al-Kursƒ´ + 1 IkhlƒÅ·π£ + 1 Falaq + 1 NƒÅs) | Zikr : 10 IstighfƒÅr + 10 ·π¢alƒÅt.'
        },
        {
          day: 'Mardi',
          night: '6 rak øat (1 FƒÅti·∏•a + 1 IkhlƒÅ·π£ + 1 Falaq + 1 NƒÅs) | Zikr : 70 Taw·∏•ƒ´d.',
          day_content: '10 rak øat (1 FƒÅti·∏•a + 1 ƒÄyat al-Kursƒ´ + 3 IkhlƒÅ·π£).'
        },
        {
          day: 'Mercredi',
          night: '4 rak øat (1 FƒÅti·∏•a + 40 IkhlƒÅ·π£) | Zikr : 70 IstighfƒÅr.',
          day_content: '4 rak øat (1 FƒÅti·∏•a + 1 ƒÄyat al-Kursƒ´ + 3 IkhlƒÅ·π£ + 1 Falaq + 1 NƒÅs).'
        },
        {
          day: 'Jeudi',
          night: '8 rak øat (1 FƒÅti·∏•a + 10 IkhlƒÅ·π£) | Zikr : 100 Formule du Jeudi.',
          day_content: '4 rak øat (1 FƒÅti·∏•a + 5 Na·π£r + 50 Kawthar) | Zikr : 10 IstighfƒÅr.'
        },
        {
          day: 'Vendredi',
          night: '4 rak øat (1 FƒÅti·∏•a + 50 Zalzalah).',
          day_content: '2 rak øat (1 ≥·µâ : 1 FƒÅti·∏•a + 1 ƒÄyat al-Kursƒ´ + 25 Falaq ; 2·µâ : 1 FƒÅti·∏•a + 1 IkhlƒÅ·π£ + 25 NƒÅs) | Zikr : 50 Formule du Vendredi.'
        },
        {
          day: 'Samedi',
          night: '6 rak øat (1 FƒÅti·∏•a + 3 IkhlƒÅ·π£).',
          day_content: '4 rak øat (1 FƒÅti·∏•a + 3 KƒÅfir≈´n) | Zikr : 3 ƒÄyat al-Kursƒ´.'
        }
      ];

      // Fonction de rendu du programme d√©taill√© - Version robuste
      let programmeLoaded = false;
      async function renderProgramme() {
        if (programmeLoaded) return;

        // Indiquer le chargement en cours
        const dailyGrid = $("#program-daily-grid");
        const zikrGrid = $("#personal-zikr-grid");
        
        if (dailyGrid) dailyGrid.innerHTML = '<div class="text-center text-slate-500 col-span-full py-8">Chargement...</div>';
        if (zikrGrid) zikrGrid.innerHTML = '<div class="text-center text-slate-500 col-span-full py-8">Chargement...</div>';

        try {
          // Charger les donn√©es du programme depuis le fichier JSON
          const response = await fetch('./data/programme.json');
          let programData;

          if (response.ok) {
            programData = await response.json();
            console.log('[Programme] Donn√©es charg√©es depuis JSON');
          } else {
            throw new Error(`Erreur HTTP ${response.status}: ${response.statusText}`);
          }

          // V√©rifier que les donn√©es sont valides
          if (!programData || typeof programData !== 'object') {
            throw new Error('Structure de donn√©es invalide');
          }

          // 1. Programme quotidien
          if (dailyGrid && programData.daily && Array.isArray(programData.daily)) {
            setTimeout(() => {
              dailyGrid.innerHTML = '';
              programData.daily.forEach((program, index) => {
                if (!program || !program.day) {
                  console.warn(`Programme manquant pour l'index ${index}`);
                  return;
                }
                
                const cardHtml = `
                  <div class="bg-white rounded-2xl shadow-lg p-6 space-y-3 hover:shadow-xl transition-shadow duration-300">
                    <h3 class="text-2xl font-bold text-[#6A4A3C]">${program.day}</h3>
                    <div>
                      <h4 class="font-semibold text-gray-700 mb-1">üåô Nuit</h4>
                      <p class="text-sm text-gray-600 leading-relaxed">${program.night || 'Aucune activit√© sp√©cifique'}</p>
                    </div>
                    <div>
                      <h4 class="font-semibold text-gray-700 mb-1">‚òÄÔ∏è Jour</h4>
                      <p class="text-sm text-gray-600 leading-relaxed">${program.day_content || 'Aucune activit√© sp√©cifique'}</p>
                    </div>
                  </div>
                `;
                dailyGrid.insertAdjacentHTML('beforeend', cardHtml);
              });
              console.log('[Programme] Programme quotidien rendu avec succ√®s');
            }, 300);
          } else if (dailyGrid) {
            dailyGrid.innerHTML = `
              <div class="col-span-full text-center py-8">
                <div class="text-orange-600 text-lg mb-2">‚ö†Ô∏è Donn√©es manquantes</div>
                <div class="text-gray-600 text-sm">Programme quotidien non disponible</div>
              </div>
            `;
          }

          // 2. Zikrs personnalis√©s
          if (zikrGrid && programData.personalZikr && Array.isArray(programData.personalZikr)) {
            setTimeout(() => {
              zikrGrid.innerHTML = '';
              const currentDay = moment().day();

              programData.personalZikr.forEach((zikr, index) => {
                if (!zikr || !zikr.title) {
                  console.warn(`Zikr manquant pour l'index ${index}`);
                  return;
                }

                let badge = '';
                if (zikr.condition === 'daily') {
                  badge = '<span class="inline-flex rounded-full bg-emerald-100 text-emerald-700 text-xs px-2 py-0.5">Quotidien</span>';
                } else if (zikr.condition === 'friday' && currentDay === 5) {
                  badge = '<span class="inline-flex rounded-full bg-emerald-100 text-emerald-700 text-xs px-2 py-0.5">Aujourd\'hui</span>';
                } else if (zikr.condition === 'wednesday' && currentDay === 3) {
                  badge = '<span class="inline-flex rounded-full bg-emerald-100 text-emerald-700 text-xs px-2 py-0.5">Ce soir</span>';
                } else if (zikr.condition === 'friday-every-prayer' && currentDay === 5) {
                  badge = '<span class="inline-flex rounded-full bg-emerald-100 text-emerald-700 text-xs px-2 py-0.5">√Ä chaque ·π£alƒÅt</span>';
                }

                const countDisplay = zikr.count ? `<div class="text-3xl font-bold text-[#6A4A3C]">${zikr.count}√ó</div>` : '';

                const cardHtml = `
                  <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col justify-between hover:shadow-xl transition-all duration-300">
                    <div>
                      <div class="flex items-start justify-between mb-3">
                        <h3 class="text-lg font-bold text-[#6A4A3C]">${zikr.title}</h3>
                        ${badge}
                      </div>
                      ${countDisplay}
                      <p class="text-sm text-gray-500 mb-3">${zikr.periodicity || 'P√©riodicit√© non sp√©cifi√©e'}</p>
                      <p class="arabic-text text-lg mt-2 leading-relaxed">${zikr.arabic || ''}</p>
                    </div>
                  </div>
                `;
                zikrGrid.insertAdjacentHTML('beforeend', cardHtml);
              });
              console.log('[Programme] Zikrs personnalis√©s rendus avec succ√®s');
            }, 500);
          } else if (zikrGrid) {
            zikrGrid.innerHTML = `
              <div class="col-span-full text-center py-8">
                <div class="text-orange-600 text-lg mb-2">‚ö†Ô∏è Donn√©es manquantes</div>
                <div class="text-gray-600 text-sm">Zikrs personnalis√©s non disponibles</div>
              </div>
            `;
          }

          programmeLoaded = true;
          console.log('[Programme] Contenu charg√© avec succ√®s');

        } catch (error) {
          console.error('[Programme] Erreur de chargement:', error);
          programmeLoaded = false; // Permettre une nouvelle tentative

          const errorMessage = `
            <div class="col-span-full text-center py-8">
              <div class="text-red-600 text-lg mb-2">‚ö†Ô∏è Erreur de chargement</div>
              <div class="text-gray-600 text-sm">Impossible de charger le programme d√©taill√©</div>
              <div class="text-xs text-gray-500 mt-2">${error.message}</div>
              <button onclick="location.reload()" class="mt-3 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                Recharger la page
              </button>
            </div>
          `;

          if (dailyGrid) dailyGrid.innerHTML = errorMessage;
          if (zikrGrid) zikrGrid.innerHTML = errorMessage;
        }
      }

      // Fonction de rendu de la retraite
      let retraiteLoaded = false;
      async function renderRetraite() {
        if (retraiteLoaded) return;

        try {
          const response = await fetch('./data/retraite.json');
          if (!response.ok) throw new Error(`Erreur ${response.status}`);

          const data = await response.json();

          // 1. Grille quotidienne
          const gridContainer = $("#retreat-grid");
          let gridHtml = `
            <table class="w-full border-collapse border border-slate-300">
              <thead>
                <tr class="bg-slate-100">
                  <th class="border border-slate-300 p-3 text-left font-semibold">Cr√©neaux</th>
                  <th class="border border-slate-300 p-3 text-left font-semibold">Activit√©s Constantes</th>
                </tr>
              </thead>
              <tbody>
          `;

          data.grilleQuotidienne.forEach(item => {
            gridHtml += `
              <tr>
                <td class="border border-slate-300 p-3 font-medium">${item.creneau}</td>
                <td class="border border-slate-300 p-3">${item.constant}</td>
              </tr>
            `;
          });

          gridHtml += '</tbody></table>';
          gridContainer.innerHTML = gridHtml;

          // 2. Accents par semaine
          const weeksContainer = $("#retreat-weeks");
          let weeksHtml = '';

          Object.entries(data.themes).forEach(([semaine, theme]) => {
            const accent = data.accentsHebdo[semaine];
            weeksHtml += `
              <div class="border rounded-lg p-4">
                <h3 class="font-semibold mb-2">Semaine ${semaine}</h3>
                <h4 class="text-emerald-600 font-medium mb-3">${theme}</h4>

                <div class="space-y-3">
                  <div>
                    <h5 class="font-medium text-sm mb-1">Notes :</h5>
                    <ul class="text-sm text-slate-600 space-y-1">
                      ${accent.notes.map(note => `<li>‚Ä¢ ${note}</li>`).join('')}
                    </ul>
                  </div>

                  <div>
                    <h5 class="font-medium text-sm mb-1">Exemples :</h5>
                    <ul class="text-sm text-slate-600 space-y-1">
                      ${accent.exemples.map(exemple => `<li>‚Ä¢ ${exemple}</li>`).join('')}
                    </ul>
                  </div>
                </div>
              </div>
            `;
          });
          weeksContainer.innerHTML = weeksHtml;

          // 3. Planning annuel all√©g√©
          const annualContainer = $("#retreat-annual");
          const annual = data.annuelAllege;
          let annualHtml = `
            <div class="grid md:grid-cols-2 gap-6">
              <div class="border rounded-lg p-4">
                <h3 class="font-semibold mb-3">Routine Hebdomadaire</h3>
                <div class="space-y-3">
                  <div>
                    <h4 class="font-medium text-slate-700 mb-1">üåô Matin</h4>
                    <p class="text-sm text-slate-600">${annual.semaine.matin}</p>
                  </div>
                  <div>
                    <h4 class="font-medium text-slate-700 mb-1">üåû Midi</h4>
                    <p class="text-sm text-slate-600">${annual.semaine.midi}</p>
                  </div>
                  <div>
                    <h4 class="font-medium text-slate-700 mb-1">üåÜ Soir</h4>
                    <p class="text-sm text-slate-600">${annual.semaine.soir}</p>
                  </div>
                </div>
              </div>

              <div class="border rounded-lg p-4">
                <h3 class="font-semibold mb-3">Avant le Sommeil</h3>
                <p class="text-sm text-slate-600">${annual.avantSommeil}</p>
              </div>
            </div>
          `;
          annualContainer.innerHTML = annualHtml;

          retraiteLoaded = true;
          console.log('[Retraite] Contenu charg√© avec succ√®s');

        } catch (error) {
          console.error('[Retraite] Erreur de chargement:', error);
          $("#retreat-grid").innerHTML = '<p class="text-red-600">Erreur de chargement de la retraite</p>';
        }
      }

      // Fonction de rendu des mois
      let moisLoaded = false;
      async function renderMois() {
        if (moisLoaded) return;

        try {
          const response = await fetch('./data/mois.json');
          if (!response.ok) throw new Error(`Erreur ${response.status}`);

          const data = await response.json();
          const now = moment();
          const currentHijriMonth = now.iMonth(); // Index du mois hijri (0-11)
          const currentHijriDay = now.iDate(); // Jour du mois hijri

          // Trouver le mois actuel
          const currentMonth = data.mois.find(m => m.i === currentHijriMonth);

          // V√©rifier s'il y a un jour sp√©cial aujourd'hui
          const specialDay = data.jours.find(j => j.m === currentHijriMonth && j.d === currentHijriDay);

          // Afficher l'alerte si jour sp√©cial
          const alerteEl = $("#jour-alerte");
          const alerteContentEl = $("#jour-alerte-content");

          if (specialDay) {
            alerteEl.classList.remove("hidden");
            alerteContentEl.innerHTML = `
              <h4 class="font-semibold mb-2 text-amber-800">${specialDay.titre}</h4>
              <div class="space-y-2">
                <p class="text-sm text-amber-700">Recommandations :</p>
                <ul class="text-sm text-amber-700 space-y-1">
                  ${specialDay.reco.map(r => `<li>‚Ä¢ ${r}</li>`).join('')}
                </ul>
              </div>
            `;
          } else {
            alerteEl.classList.add("hidden");
          }

          // Afficher les informations du mois
          const moisInfoEl = $("#mois-info");
          let moisHtml = '';

          if (currentMonth) {
            moisHtml = `
              <div class="text-center mb-6">
                <h3 class="text-3xl font-semibold mb-2 title">${currentMonth.nom}</h3>
                <p class="text-slate-600 text-lg">${currentMonth.sens}</p>
                <p class="text-sm text-slate-500 mt-1">${now.format('iMMMM iYYYY')}</p>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div class="border rounded-lg p-4">
                  <h4 class="font-semibold mb-3 text-emerald-600">‚ú® Jours cl√©s ce mois-ci</h4>
                  ${currentMonth.cles.length > 0
                    ? `<ul class="space-y-2">${currentMonth.cles.map(c => `<li class="text-sm">‚Ä¢ ${c}</li>`).join('')}</ul>`
                    : '<p class="text-sm text-slate-500">Aucun jour particulier ce mois-ci</p>'
                  }
                </div>

                <div class="border rounded-lg p-4">
                  <h4 class="font-semibold mb-3 text-blue-600">ü§≤ Pratiques recommand√©es</h4>
                  <ul class="space-y-2">
                    ${currentMonth.pratiques.map(p => `<li class="text-sm">‚Ä¢ ${p}</li>`).join('')}
                  </ul>
                </div>
              </div>

              <div class="mt-6 bg-slate-50 rounded-lg p-4">
                <h4 class="font-semibold mb-3">üìÖ Autres jours importants de l'ann√©e</h4>
                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
                  ${data.jours.map(j => {
                    const mois = data.mois.find(m => m.i === j.m);
                    return `
                      <div class="p-3 border rounded-lg">
                        <div class="font-medium">${j.titre}</div>
                        <div class="text-slate-500">${j.d} ${mois?.nom || ''}</div>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
            `;
          } else {
            moisHtml = '<p class="text-red-600 text-center">Erreur : mois hijri non trouv√©</p>';
          }

          moisInfoEl.innerHTML = moisHtml;
          moisLoaded = true;
          console.log('[Mois] Contenu charg√© avec succ√®s');

        } catch (error) {
          console.error('[Mois] Erreur de chargement:', error);
          $("#mois-info").innerHTML = '<p class="text-red-600 text-center">Erreur de chargement des donn√©es du mois</p>';
        }
      }

      // Syst√®me de notifications pour les pri√®res
      let notificationPermission = false;
      let prayerNotifications = new Set();

      async function requestNotificationPermission() {
        if ('Notification' in window) {
          const permission = await Notification.requestPermission();
          notificationPermission = permission === 'granted';
          console.log('[Notifications] Permission:', permission);
          return notificationPermission;
        }
        return false;
      }

      function sendPrayerNotification(prayerName, timeLeft) {
        if (!notificationPermission) return;

        const notification = new Notification(`üïå ${prayerName}`, {
          body: `Il est temps pour la pri√®re ${prayerName}`,
          icon: 'manifest.json',
          badge: 'manifest.json',
          tag: `prayer-${prayerName}`,
          requireInteraction: true,
          actions: [
            { action: 'done', title: 'Marqu√© comme fait ‚úÖ' },
            { action: 'remind', title: 'Rappeler dans 5 min ‚è∞' }
          ]
        });

        notification.onclick = () => {
          window.focus();
          show('journal');
          notification.close();
        };

        // Auto-fermer apr√®s 30 secondes
        setTimeout(() => notification.close(), 30000);
      }

      function scheduleNextPrayerNotification() {
        const { p, t } = nextPrayer();
        const now = moment();
        const diffMs = t.diff(now);

        // Notification 5 minutes avant
        const fiveMinBefore = diffMs - (5 * 60 * 1000);
        if (fiveMinBefore > 0) {
          setTimeout(() => {
            if (notificationPermission) {
              new Notification(`üïå ${p.name} dans 5 minutes`, {
                body: `Pr√©parez-vous pour la pri√®re ${p.name}`,
                tag: `prayer-reminder-${p.name}`,
                icon: 'manifest.json'
              });
            }
          }, fiveMinBefore);
        }

        // Notification √† l'heure exacte
        if (diffMs > 0) {
          setTimeout(() => {
            sendPrayerNotification(p.name, 0);
            // Programmer la prochaine notification
            setTimeout(scheduleNextPrayerNotification, 1000);
          }, diffMs);
        }
      }

      // Initialiser les notifications
      requestNotificationPermission().then(granted => {
        if (granted) {
          scheduleNextPrayerNotification();
          console.log('[Notifications] Syst√®me de notifications activ√©');
        }
      });

      // Charger le contenu lors de l'ouverture des onglets
      $$('[data-tab="programme"]')[0].addEventListener("click", renderProgramme);
      $$('[data-tab="lectures"]')[0].addEventListener("click", () => {
        initLectures();
      });
      $$('[data-tab="retraite"]')[0].addEventListener("click", renderRetraite);
      $$('[data-tab="journal"]')[0].addEventListener("click", async () => {
        await initJournal();
        setupJournalHistoryEventListeners();
        await loadLast7Days();
        await updateJournalStats();
      });
      $$('[data-tab="mois"]')[0].addEventListener("click", renderMois);

      // Initialiser les lectures imm√©diatement pour que les onglets fonctionnent
      initLectures();

      // Fonctions pour l'historique et la progression du Journal
      async function loadJournalForDate(targetDate) {
        const api = window.storageAPI;
        if (!api) return;

        try {
          const dateStr = moment(targetDate).format("YYYY-MM-DD");

          // Charger les pri√®res pour cette date
          const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
          let prayersStatus = [];
          for (const prayer of prayers) {
            const isChecked = await api.storageGet(`jp:${dateStr}:${prayer}`, false);
            prayersStatus.push({ prayer, done: isChecked });
          }

          // Charger la note pour cette date
          const noteContent = await api.storageGet(`note:${dateStr}`, "");

          // Afficher dans une modal ou section d√©di√©e
          displayDateHistory(dateStr, prayersStatus, noteContent);

        } catch (error) {
          console.error('[Journal History] Erreur:', error);
        }
      }

      function displayDateHistory(dateStr, prayersStatus, noteContent) {
        const formattedDate = moment(dateStr).format("dddd D MMMM YYYY");

        // Cr√©er le contenu de l'historique
        let prayersHtml = prayersStatus.map(p => 
          `<span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs ${
            p.done ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'
          }">
            ${p.done ? '‚úì' : '‚óã'} ${p.prayer}
          </span>`
        ).join(' ');

        const historyHtml = `
          <div class="border-l-4 border-islamic-green bg-white rounded-r-xl p-4 shadow-md">
            <div class="flex items-center justify-between mb-3">
              <h5 class="font-semibold text-slate-800">${formattedDate}</h5>
              <div class="text-xs text-slate-500">${prayersStatus.filter(p => p.done).length}/5 pri√®res</div>
            </div>
            <div class="flex flex-wrap gap-2 mb-3">
              ${prayersHtml}
            </div>
            ${noteContent ? `
              <div class="bg-slate-50 rounded-lg p-3">
                <div class="text-xs text-slate-600 mb-1">Note du jour :</div>
                <div class="text-sm text-slate-800">${noteContent.length > 100 ? noteContent.substring(0, 100) + '...' : noteContent}</div>
              </div>
            ` : '<div class="text-xs text-slate-400 italic">Aucune note ce jour-l√†</div>'}
          </div>
        `;

        // Ajouter en haut de la liste d'historique
        const historyGrid = $("#journal-history-grid");
        if (historyGrid) {
          historyGrid.insertAdjacentHTML('afterbegin', historyHtml);
        }
      }

      async function loadLast7Days() {
        const api = window.storageAPI;
        if (!api) return;

        const historyGrid = $("#journal-history-grid");
        if (!historyGrid) return;

        historyGrid.innerHTML = '<div class="text-center text-slate-500">Chargement...</div>';

        try {
          const today = moment();
          const historyHtml = [];

          for (let i = 0; i < 7; i++) {
            const date = today.clone().subtract(i, 'days');
            const dateStr = date.format("YYYY-MM-DD");

            // Charger les donn√©es pour cette date
            const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            let prayersCount = 0;
            for (const prayer of prayers) {
              const isDone = await api.storageGet(`jp:${dateStr}:${prayer}`, false);
              if (isDone) prayersCount++;
            }

            const noteContent = await api.storageGet(`note:${dateStr}`, "");
            const hasNote = noteContent && noteContent.trim().length > 0;

            // Cr√©er la carte pour ce jour
            const dayHtml = `
              <div class="flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200 hover:shadow-md transition-shadow duration-300">
                <div class="flex items-center gap-3">
                  <div class="text-sm font-medium text-slate-800">${date.format("ddd DD/MM")}</div>
                  <div class="flex items-center gap-2">
                    <div class="flex items-center gap-1">
                      <span class="text-xs text-slate-600">ü§≤</span>
                      <span class="text-xs font-medium">${prayersCount}/5</span>
                    </div>
                    ${hasNote ? '<span class="text-xs">üìù</span>' : ''}
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <div class="w-16 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-islamic transition-all duration-300" style="width: ${(prayersCount/5)*100}%"></div>
                  </div>
                  <button 
                    onclick="loadJournalForDate('${dateStr}')" 
                    class="text-xs text-islamic-green hover:text-emerald-700 font-medium"
                  >
                    Voir
                  </button>
                </div>
              </div>
            `;
            historyHtml.push(dayHtml);
          }

          historyGrid.innerHTML = historyHtml.join('');
        } catch (error) {
          console.error('[Journal] Erreur chargement historique:', error);
          historyGrid.innerHTML = '<div class="text-center text-red-500">Erreur de chargement</div>';
        }
      }

      async function updateJournalStats() {
        const api = window.storageAPI;
        if (!api) return;

        try {
          // Compter les jours avec des notes (sur les 30 derniers jours)
          let notesCount = 0;
          let totalDhikr = await api.storageGet("tasbihCount", 0);

          for (let i = 0; i < 30; i++) {
            const date = moment().subtract(i, 'days').format("YYYY-MM-DD");
            const note = await api.storageGet(`note:${date}`, "");
            if (note && note.trim().length > 0) notesCount++;
          }

          // Calculer la s√©rie actuelle (d√©j√† disponible)
          const streakDays = await calculateStreak();

          // Mettre √† jour l'affichage
          const notesCountEl = $("#stats-notes-count");
          const streakEl = $("#stats-current-streak");
          const dhikrEl = $("#stats-total-dhikr");

          if (notesCountEl) notesCountEl.textContent = notesCount;
          if (streakEl) streakEl.textContent = `${streakDays} jours`;
          if (dhikrEl) dhikrEl.textContent = totalDhikr;

        } catch (error) {
          console.error('[Journal Stats] Erreur:', error);
        }
      }

      async function searchInNotes(query) {
        const api = window.storageAPI;
        if (!api || !query.trim()) return;

        const resultsContainer = $("#notes-search-results");
        if (!resultsContainer) return;

        resultsContainer.innerHTML = '<div class="text-center text-slate-500">Recherche en cours...</div>';

        try {
          const results = [];
          // Chercher dans les 60 derniers jours
          for (let i = 0; i < 60; i++) {
            const date = moment().subtract(i, 'days');
            const dateStr = date.format("YYYY-MM-DD");
            const note = await api.storageGet(`note:${dateStr}`, "");

            if (note && note.toLowerCase().includes(query.toLowerCase())) {
              results.push({
                date: dateStr,
                formattedDate: date.format("DD/MM/YYYY"),
                content: note
              });
            }
          }

          if (results.length === 0) {
            resultsContainer.innerHTML = '<div class="text-center text-slate-400">Aucun r√©sultat trouv√©</div>';
            return;
          }

          const resultsHtml = results.map(result => `
            <div class="bg-white border border-slate-200 rounded-lg p-4">
              <div class="text-sm font-medium text-slate-800 mb-2">${result.formattedDate}</div>
              <div class="text-sm text-slate-600 leading-relaxed">
                ${result.content.length > 200 ? result.content.substring(0, 200) + '...' : result.content}
              </div>
              <button 
                onclick="loadJournalForDate('${result.date}')" 
                class="mt-2 text-xs text-purple-600 hover:text-purple-800 font-medium"
              >
                Voir la journ√©e compl√®te ‚Üí
              </button>
            </div>
          `).join('');

          resultsContainer.innerHTML = resultsHtml;

        } catch (error) {
          console.error('[Notes Search] Erreur:', error);
          resultsContainer.innerHTML = '<div class="text-center text-red-500">Erreur de recherche</div>';
        }
      }

      // Event listeners pour les nouvelles fonctionnalit√©s
      function setupJournalHistoryEventListeners() {
        const loadDateBtn = $("#journal-load-date-btn");
        const datePicker = $("#journal-date-picker");
        const searchBtn = $("#notes-search-btn");
        const searchInput = $("#notes-search-input");

        if (loadDateBtn && datePicker) {
          loadDateBtn.addEventListener("click", () => {
            const selectedDate = datePicker.value;
            if (selectedDate) {
              loadJournalForDate(selectedDate);
            }
          });
        }

        if (searchBtn && searchInput) {
          searchBtn.addEventListener("click", () => {
            searchInNotes(searchInput.value);
          });

          searchInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              searchInNotes(searchInput.value);
            }
          });
        }
      }

      // Syst√®me de rappels personnalis√©s
      const activeReminders = new Map();

      function setReminder(taskId, delayMinutes) {
        // Annuler l'ancien rappel s'il existe
        if (activeReminders.has(taskId)) {
          clearTimeout(activeReminders.get(taskId));
        }

        // Programmer le nouveau rappel
        const timeoutId = setTimeout(() => {
          if (notificationPermission) {
            const taskNames = {
              'istighfar': 'üìø IstighfƒÅr quotidien',
              'salat-prophet': 'ü§≤ ·π¢alƒÅt sur le Proph√®te',
              'hasbunallah': '‚ú® Hasbunallah',
              'dua-defunts': 'ü§ç Du øƒÅ pour les d√©funts'
            };

            new Notification(`${taskNames[taskId] || 'üîî Rappel'}`, {
              body: `Il est temps de faire votre pratique spirituelle !`,
              icon: 'manifest.json',
              tag: `reminder-${taskId}`,
              requireInteraction: true
            });
          }

          // Retirer de la liste des rappels actifs
          activeReminders.delete(taskId);

          // Feedback visuel
          showReminderFeedback(taskId, 'reminder');
        }, delayMinutes * 60 * 1000);

        activeReminders.set(taskId, timeoutId);
        showReminderFeedback(taskId, 'set', delayMinutes);
      }

      function markAsCompleted(taskId) {
        // Annuler le rappel s'il est actif
        if (activeReminders.has(taskId)) {
          clearTimeout(activeReminders.get(taskId));
          activeReminders.delete(taskId);
        }

        showReminderFeedback(taskId, 'completed');

        // Sauvegarder la completion
        const api = window.storageAPI;
        if (api) {
          const today = moment().format("YYYY-MM-DD");
          api.storageSet(`completed:${today}:${taskId}`, true);
        }
      }

      function showReminderFeedback(taskId, action, delayMinutes = 0) {
        const notification = $(`#daily-${taskId}`);
        if (!notification) return;

        let message = '';
        let className = '';

        switch (action) {
          case 'set':
            message = `‚è∞ Rappel dans ${delayMinutes} minutes`;
            className = 'bg-blue-100 border-blue-300 text-blue-800';
            break;
          case 'completed':
            message = '‚úÖ Marqu√© comme termin√© !';
            className = 'bg-green-100 border-green-300 text-green-800';
            break;
          case 'reminder':
            message = 'üîî C\'est l\'heure !';
            className = 'bg-yellow-100 border-yellow-300 text-yellow-800';
            break;
        }

        // Cr√©er ou mettre √† jour le badge de feedback
        let feedbackBadge = notification.querySelector('.feedback-badge');
        if (!feedbackBadge) {
          feedbackBadge = document.createElement('div');
          feedbackBadge.className = 'feedback-badge absolute -top-2 -right-2 px-2 py-1 text-xs rounded-full border transition-all duration-300';
          notification.style.position = 'relative';
          notification.appendChild(feedbackBadge);
        }

        feedbackBadge.textContent = message;
        feedbackBadge.className = `feedback-badge absolute -top-2 -right-2 px-2 py-1 text-xs rounded-full border transition-all duration-300 ${className}`;

        // Masquer apr√®s 5 secondes
        setTimeout(() => {
          if (feedbackBadge && feedbackBadge.parentNode) {
            feedbackBadge.remove();
          }
        }, 5000);
      }

      // Restaurer les completions du jour
      async function restoreTodayCompletions() {
        const api = window.storageAPI;
        if (!api) return;

        const today = moment().format("YYYY-MM-DD");
        const tasks = ['istighfar', 'salat-prophet', 'hasbunallah', 'dua-defunts'];

        for (const taskId of tasks) {
          const isCompleted = await api.storageGet(`completed:${today}:${taskId}`, false);
          if (isCompleted) {
            showReminderFeedback(taskId, 'completed');
          }
        }
      }

      // Exposer les fonctions globalement pour les boutons onclick
      window.loadJournalForDate = loadJournalForDate;
      window.setReminder = setReminder;
      window.markAsCompleted = markAsCompleted;

      // Restaurer les completions au chargement
      setTimeout(restoreTodayCompletions, 2000);

      // Ic√¥nes lucide
      window.lucide?.createIcons();


      // Horloge g√©n√©rale et mise √† jour du focus du jour
      function tick() {
        const now = moment();
        $("#clock").textContent = now.format("HH:mm:ss");
        $("#date-greg").textContent = now.format("dddd D MMMM YYYY");
        // Ne pas √©craser la date hijri ici, elle est g√©r√©e par tickClock()

        // Utiliser la fonction updateCountdown existante qui calcule le temps restant dynamiquement
        updateCountdown();
      }
      setInterval(tick, 1000);
      tick();

      // Initialisation du Focus du jour
      updateDailyFocus();
      setInterval(updateDailyFocus, 60000); // Update focus every minute

    </script>
  </body>
</html>