<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compagnon Spirituel</title>

    <!-- Styles & Librairies externes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/locale/fr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/moment-hijri.min.js"></script>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#fdfaf6" />

    <!-- CSS int√©gr√© -->
    <style>
      :root {
        --bg: linear-gradient(135deg, #fdfbf7 0%, #f7f3ed 100%);
        --card: rgba(255, 255, 255, 0.95);
        --ink: #2c1810;
        --muted: #8b7355;
        --islamic-green: #00a86b;
        --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.08);
        --gradient-islamic: linear-gradient(135deg, #00a86b 0%, #059669 100%);
        --border-soft: rgba(139, 115, 85, 0.2);
      }

      html, body {
        height: 100%;
        background: var(--bg);
        background-attachment: fixed;
        font-family: system-ui, -apple-system, sans-serif;
        color: var(--ink);
      }

      .title {
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .card {
        background: var(--card);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        box-shadow: var(--shadow-soft);
        border: 1px solid var(--border-soft);
        padding: 2rem;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-islamic);
        border-radius: 24px 24px 0 0;
      }

      .tab-btn {
        position: relative;
        padding: 0.75rem 1.5rem;
        border-radius: 16px;
        transition: all 0.3s ease;
        font-weight: 500;
        color: var(--muted);
        border: 1px solid transparent;
        cursor: pointer;
        background: none;
      }

      .tab-btn[aria-selected="true"] {
        background: var(--gradient-islamic);
        color: white;
        box-shadow: 0 8px 25px rgba(0, 168, 107, 0.3);
      }

      .tab-btn:hover:not([aria-selected="true"]) {
        background: rgba(0, 168, 107, 0.1);
        color: var(--islamic-green);
        border-color: rgba(0, 168, 107, 0.2);
      }

      .prayer-card {
        background: var(--card);
        border: 1px solid var(--border-soft);
        border-radius: 20px;
        padding: 1.5rem;
        transition: all 0.4s ease;
        position: relative;
      }

      .prayer-card.ring {
        background: linear-gradient(135deg, rgba(0, 168, 107, 0.15) 0%, rgba(0, 168, 107, 0.05) 100%);
        border-color: var(--islamic-green);
        box-shadow: 0 0 30px rgba(0, 168, 107, 0.25);
        transform: translateY(-2px);
      }

      .journal-section {
        background: var(--card);
        border-radius: 24px;
        padding: 2.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border-soft);
        box-shadow: var(--shadow-soft);
        position: relative;
        overflow: hidden;
      }

      .journal-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient-islamic);
        border-radius: 24px 24px 0 0;
      }

      .checkbox-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,250,252,0.9) 100%);
        border-radius: 16px;
        border: 1px solid var(--border-soft);
        transition: all 0.3s ease;
        margin-bottom: 0.75rem;
      }

      .checkbox-container:hover {
        background: linear-gradient(135deg, rgba(0,168,107,0.05) 0%, rgba(0,168,107,0.02) 100%);
        border-color: var(--islamic-green);
      }

      .checkbox-container input[type="checkbox"] {
        width: 1.25rem;
        height: 1.25rem;
        accent-color: var(--islamic-green);
        border-radius: 4px;
      }

      .tasbih-counter {
        font-family: "Courier New", monospace;
        font-size: 4rem;
        font-weight: 700;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 2rem 0;
      }

      .tasbih-button {
        width: 10rem;
        height: 10rem;
        border-radius: 50%;
        background: var(--gradient-islamic);
        border: none;
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 20px 60px rgba(0, 168, 107, 0.3);
      }

      .tasbih-button:hover {
        transform: scale(1.05);
      }

      .tasbih-button:active {
        transform: scale(0.95);
      }

      .notes-textarea {
        width: 100%;
        min-height: 200px;
        padding: 2rem;
        border: 2px solid var(--border-soft);
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.9) 100%);
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.6;
        color: var(--ink);
        resize: vertical;
        transition: all 0.3s ease;
      }

      .notes-textarea:focus {
        outline: none;
        border-color: var(--islamic-green);
        box-shadow: 0 0 0 4px rgba(0, 168, 107, 0.1);
      }

      @media (max-width: 768px) {
        .card {
          padding: 1.5rem;
        }
        .journal-section {
          padding: 2rem;
        }
        .tasbih-counter {
          font-size: 3rem;
        }
        .tasbih-button {
          width: 8rem;
          height: 8rem;
          font-size: 1.25rem;
        }
      }
    </style>
  </head>

  <body class="text-slate-800">
    <!-- Header -->
    <header class="max-w-5xl mx-auto px-4 py-10">
      <h1 class="title text-center text-5xl sm:text-6xl text-slate-800">
        Compagnon Spirituel
      </h1>
      <p class="text-center text-orange-600 mt-2">
        Votre guide spirituel quotidien
      </p>

      <!-- Horloge & Dates -->
      <div class="mt-8 card max-w-xl mx-auto text-center">
        <div id="clock" class="text-4xl sm:text-5xl text-slate-700 font-mono">
          --:--:--
        </div>
        <div class="mt-5">
          <div id="date-greg" class="font-semibold text-sky-600">‚Äî</div>
          <div id="date-hijri" class="text-slate-500 font-medium">‚Äî</div>
        </div>
        <div class="mt-4">
          <span id="mode-badge" class="inline-block px-4 py-2 bg-orange-100 text-orange-800 rounded-full text-sm font-medium">Planning Annuel</span>
        </div>
      </div>

      <!-- Focus du jour -->
      <div class="mt-8 card max-w-4xl mx-auto">
        <div class="text-center mb-6">
          <h2 class="text-3xl font-bold text-slate-800 mb-2">Focus du Jour</h2>
          <p id="daily-focus-time" class="text-lg text-slate-600 font-medium"></p>
        </div>
        <div id="daily-focus-content" class="text-lg text-slate-700 leading-relaxed text-center"></div>
        <div id="weekly-special-focus" class="mt-6 space-y-4"></div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="sticky top-0 z-20 bg-white/80 backdrop-blur border-y border-slate-200/70">
      <div class="max-w-5xl mx-auto px-4">
        <ul class="flex flex-wrap gap-2 sm:gap-3 py-3">
          <li><button class="tab-btn" data-tab="accueil" aria-selected="true">Accueil</button></li>
          <li><button class="tab-btn" data-tab="programme">Programme</button></li>
          <li><button class="tab-btn" data-tab="lectures">Lectures</button></li>
          <li><button class="tab-btn" data-tab="retraite">Retraite</button></li>
          <li><button class="tab-btn" data-tab="journal">Journal</button></li>
          <li><button class="tab-btn" data-tab="mois">Mois</button></li>
          <li><button class="tab-btn" data-tab="qibla">Qibla</button></li>
        </ul>
      </div>
    </nav>

    <!-- Pages -->
    <main class="max-w-5xl mx-auto px-4 py-8 space-y-10">
      <!-- Accueil -->
      <section data-page="accueil">
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Prochaine pri√®re -->
          <div class="card">
            <h2 class="title text-2xl mb-4">Prochaine pri√®re</h2>
            <p class="text-sm text-slate-600 mb-4">üìç Bobo-Dioulasso, Burkina Faso</p>

            <div class="text-center mb-6">
              <div class="text-lg text-slate-600 mb-2">Prochaine pri√®re</div>
              <div class="text-2xl font-bold text-slate-800 mb-2" id="next-prayer-name">‚Äî</div>
              <div class="text-xl font-mono font-bold text-blue-600" id="next-prayer-eta">--:--:--</div>
              <div class="text-sm text-slate-500 mt-1">temps restant</div>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
              <div class="prayer-card" id="p-Fajr">
                <div class="font-semibold text-slate-700 mb-1">Fajr</div>
                <div class="text-lg font-mono" id="t-Fajr">05:00</div>
              </div>
              <div class="prayer-card" id="p-Shuruq">
                <div class="font-semibold text-slate-700 mb-1">Shuruq</div>
                <div class="text-lg font-mono" id="t-Shuruq">06:15</div>
              </div>
              <div class="prayer-card" id="p-Dhuhr">
                <div class="font-semibold text-slate-700 mb-1">Dhuhr</div>
                <div class="text-lg font-mono" id="t-Dhuhr">12:30</div>
              </div>
              <div class="prayer-card" id="p-Asr">
                <div class="font-semibold text-slate-700 mb-1">Asr</div>
                <div class="text-lg font-mono" id="t-Asr">15:45</div>
              </div>
              <div class="prayer-card" id="p-Maghrib">
                <div class="font-semibold text-slate-700 mb-1">Maghrib</div>
                <div class="text-lg font-mono" id="t-Maghrib">18:30</div>
              </div>
              <div class="prayer-card" id="p-Isha">
                <div class="font-semibold text-slate-700 mb-1">Isha</div>
                <div class="text-lg font-mono" id="t-Isha">19:45</div>
              </div>
            </div>
          </div>

          <!-- Tableau de bord -->
          <div class="card">
            <h2 class="title text-2xl mb-4">Tableau de Bord Spirituel</h2>

            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="text-center p-4 bg-emerald-50 rounded-xl">
                <div class="text-2xl font-bold text-emerald-700" id="prayers-today">0</div>
                <div class="text-sm text-emerald-600">Pri√®res</div>
                <div class="text-xs text-emerald-500">aujourd'hui</div>
              </div>
              <div class="text-center p-4 bg-blue-50 rounded-xl">
                <div class="text-2xl font-bold text-blue-700" id="dhikr-count">0</div>
                <div class="text-sm text-blue-600">Dhikr</div>
                <div class="text-xs text-blue-500">compt√©s</div>
              </div>
              <div class="text-center p-4 bg-purple-50 rounded-xl">
                <div class="text-2xl font-bold text-purple-700" id="streak-days">0</div>
                <div class="text-sm text-purple-600">Jours</div>
                <div class="text-xs text-purple-500">cons√©cutifs</div>
              </div>
              <div class="text-center p-4 bg-orange-50 rounded-xl">
                <div class="text-2xl font-bold text-orange-700" id="weekly-progress">0%</div>
                <div class="text-sm text-orange-600">Semaine</div>
                <div class="text-xs text-orange-500">accomplie</div>
              </div>
            </div>

            <div class="space-y-3">
              <h3 class="font-semibold text-slate-700 mb-2">Progression du Jour</h3>
              <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <span class="text-sm font-medium">Pri√®res obligatoires</span>
                <div class="flex items-center gap-2">
                  <div class="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="prayer-progress" class="h-full bg-emerald-500 transition-all duration-300" style="width: 0%"></div>
                  </div>
                  <span class="text-xs text-slate-600" id="prayer-fraction">0/5</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Programme -->
      <section data-page="programme" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-6">Programme Spirituel</h2>
          <div class="space-y-6">
            <div class="p-4 bg-blue-50 rounded-xl">
              <h3 class="font-bold text-blue-800 mb-2">üìø Zikr Quotidien</h3>
              <p class="text-blue-700">1261√ó IstighfƒÅr</p>
            </div>

            <div class="p-4 bg-green-50 rounded-xl">
              <h3 class="font-bold text-green-800 mb-2">üïå Vendredi Sp√©cial</h3>
              <ul class="text-green-700 space-y-1">
                <li>‚Ä¢ 313√ó ·π¢alƒÅt sur le Proph√®te</li>
                <li>‚Ä¢ Du øƒÅ pour les d√©funts apr√®s chaque pri√®re</li>
                <li>‚Ä¢ Lecture de Sourate Al-Kahf</li>
              </ul>
            </div>

            <div class="p-4 bg-purple-50 rounded-xl">
              <h3 class="font-bold text-purple-800 mb-2">üåô Mercredi Soir</h3>
              <p class="text-purple-700">450√ó ·∏§asbunallƒÅh wa ni ømal-wakƒ´l</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Lectures -->
      <section data-page="lectures" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Lectures Spirituelles</h2>
          <div class="text-center py-12">
            <div class="w-16 h-16 bg-gradient-to-r from-emerald-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
              <span class="text-white text-2xl">üìñ</span>
            </div>
            <p class="text-slate-500 text-lg">Section en cours de d√©veloppement</p>
            <p class="text-slate-400 text-sm mt-2">Lectures du Coran et textes spirituels</p>
          </div>
        </div>
      </section>

      <!-- Retraite -->
      <section data-page="retraite" class="hidden">
        <div class="space-y-8">
          <div class="card">
            <h2 class="title text-2xl mb-3">Configuration de la Retraite</h2>
            <label class="block text-sm text-slate-600 mb-1">Date de d√©but (4 semaines)</label>
            <input id="retreat-start" type="date" class="border rounded-lg px-3 py-2" />
            <button id="retreat-save" class="ml-2 px-3 py-2 rounded-lg bg-emerald-600 text-white">
              Enregistrer
            </button>
            <div id="retreat-msg" class="mt-3 text-slate-600">‚Äî</div>
          </div>
        </div>
      </section>

      <!-- Journal -->
      <section data-page="journal" class="hidden">
        <div class="space-y-8" id="journal-container">
          <!-- En-t√™te -->
          <div class="text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-4">ŸÖŸèÿ∞ŸéŸÉŸêŸëÿ±Ÿéÿ™ŸêŸä ÿßŸÑÿ±ŸèŸëŸàÿ≠ŸêŸäŸéŸëÿ©</h1>
            <p class="text-lg text-slate-600 font-medium">Mon Carnet Spirituel Quotidien</p>
          </div>

          <!-- Export/Import -->
          <div class="journal-section">
            <h3 class="text-xl font-bold text-slate-800 mb-4">üíæ Sauvegarde des Donn√©es</h3>
            <div class="flex flex-wrap gap-4">
              <button id="export-data" class="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-semibold">
                üì§ Exporter mes donn√©es
              </button>
              <div class="flex items-center gap-2">
                <input type="file" id="import-file" accept=".json" class="hidden" />
                <button id="import-data" class="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 font-semibold">
                  üì• Importer des donn√©es
                </button>
              </div>
            </div>
            <div id="import-status" class="mt-4 text-sm font-medium"></div>
          </div>

          <!-- Pri√®res -->
          <div class="journal-section">
            <h3 class="text-xl font-bold text-slate-800 mb-6">ÿßŸÑÿµŸéŸëŸÑŸéŸàŸéÿßÿ™ ÿßŸÑÿÆŸéŸÖÿ≥ - Les Cinq Pri√®res</h3>
            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Fajr" id="prayer-fajr" />
                <label for="prayer-fajr" class="flex items-center justify-between w-full cursor-pointer">
                  <span class="font-semibold">ÿßŸÑŸÅÿ¨ÿ± - Fajr</span>
                  <span class="text-sm text-slate-500">Aube</span>
                </label>
              </div>
              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Dhuhr" id="prayer-dhuhr" />
                <label for="prayer-dhuhr" class="flex items-center justify-between w-full cursor-pointer">
                  <span class="font-semibold">ÿßŸÑÿ∏Ÿáÿ± - Dhuhr</span>
                  <span class="text-sm text-slate-500">Midi</span>
                </label>
              </div>
              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Asr" id="prayer-asr" />
                <label for="prayer-asr" class="flex items-center justify-between w-full cursor-pointer">
                  <span class="font-semibold">ÿßŸÑÿπÿµÿ± - Asr</span>
                  <span class="text-sm text-slate-500">Apr√®s-midi</span>
                </label>
              </div>
              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Maghrib" id="prayer-maghrib" />
                <label for="prayer-maghrib" class="flex items-center justify-between w-full cursor-pointer">
                  <span class="font-semibold">ÿßŸÑŸÖÿ∫ÿ±ÿ® - Maghrib</span>
                  <span class="text-sm text-slate-500">Coucher</span>
                </label>
              </div>
              <div class="checkbox-container">
                <input type="checkbox" class="jp" value="Isha" id="prayer-isha" />
                <label for="prayer-isha" class="flex items-center justify-between w-full cursor-pointer">
                  <span class="font-semibold">ÿßŸÑÿπÿ¥ÿßÿ° - Isha</span>
                  <span class="text-sm text-slate-500">Nuit</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Compteur Tasbih -->
          <div class="journal-section">
            <div class="text-center">
              <h3 class="text-xl font-bold text-slate-800 mb-4">ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜ ÿßŸÑŸÑŸëŸáŸê - Compteur de Dhikr</h3>
              <div class="tasbih-counter" id="tasbih-counter-display">0</div>
              <p class="text-slate-600 mt-2 mb-6">invocations compt√©es</p>
              <button id="tasbih-counter-btn" class="tasbih-button mb-4">
                <div class="text-center">
                  <div class="text-xl mb-1">ÿßÿ∞ŸíŸÉŸèÿ±</div>
                  <div class="text-sm">Invoquer</div>
                </div>
              </button>
              <div>
                <button id="tasbih-reset-btn" class="text-slate-500 hover:text-red-500 underline text-sm">
                  üîÑ R√©initialiser le compteur
                </button>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="journal-section">
            <h3 class="text-xl font-bold text-slate-800 mb-4">ŸÖŸèÿ∞ŸéŸÉŸêŸëÿ±Ÿéÿßÿ™ŸêŸä - Notes Personnelles</h3>
            <textarea
              id="note"
              class="notes-textarea"
              placeholder="√âcris ici les pens√©es que ton c≈ìur a retenues aujourd'hui...

¬´ ŸàŸéŸÇŸèŸÑ ÿ±ŸéŸëÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß ¬ª - Et dis : ¬´ √î mon Seigneur, accrois mes connaissances ! ¬ª

‚ú® Moments de gratitude
ü§≤ Pri√®res exauc√©es
üìö Enseignements re√ßus
üíù Actes de bont√© accomplis"
            ></textarea>
            <div class="mt-4 flex items-center justify-between text-sm text-slate-500">
              <span>üíæ Vos notes sont automatiquement sauvegard√©es</span>
              <span class="text-lg">ÿßŸÑÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸëŸáŸê</span>
            </div>
          </div>

          <!-- Navigation par date -->
          <div class="journal-section">
            <h3 class="text-xl font-bold text-slate-800 mb-4">üìÖ Consulter un jour pr√©c√©dent</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label for="journal-date-select" class="block text-sm font-medium text-slate-700 mb-2">
                  S√©lectionner une date
                </label>
                <input
                  type="date"
                  id="journal-date-select"
                  class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:border-emerald-500 transition-all duration-300"
                />
              </div>
              <div id="selected-date-summary" class="p-4 bg-slate-50 rounded-xl">
                <h4 class="font-semibold text-slate-700 mb-2">R√©sum√© du jour s√©lectionn√©</h4>
                <div id="date-summary-content" class="text-sm text-slate-600">
                  S√©lectionnez une date pour voir le r√©sum√©
                </div>
              </div>
            </div>
          </div>

          <!-- Statistiques -->
          <div class="journal-section">
            <h3 class="text-xl font-bold text-slate-800 mb-4">üìä Statistiques</h3>
            <div class="grid md:grid-cols-3 gap-4">
              <div class="text-center p-4 bg-blue-50 rounded-xl">
                <div class="text-3xl font-bold text-blue-700" id="stats-notes-count">0</div>
                <div class="text-sm text-blue-600">Jours avec notes</div>
                <div class="text-xs text-blue-500">(30 derniers jours)</div>
              </div>
              <div class="text-center p-4 bg-emerald-50 rounded-xl">
                <div class="text-3xl font-bold text-emerald-700" id="stats-current-streak">0</div>
                <div class="text-sm text-emerald-600">S√©rie actuelle</div>
                <div class="text-xs text-emerald-500">jours cons√©cutifs</div>
              </div>
              <div class="text-center p-4 bg-purple-50 rounded-xl">
                <div class="text-3xl font-bold text-purple-700" id="stats-total-dhikr">0</div>
                <div class="text-sm text-purple-600">Total dhikr</div>
                <div class="text-xs text-purple-500">compt√©s √† ce jour</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mois -->
      <section data-page="mois" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Mois h√©girien en cours</h2>
          <div class="text-center py-12">
            <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
              <span class="text-white text-2xl">üåô</span>
            </div>
            <p class="text-slate-500 text-lg">Informations du mois hijri</p>
            <p class="text-slate-400 text-sm mt-2">Jours sp√©ciaux et pratiques recommand√©es</p>
          </div>
        </div>
      </section>

      <!-- Qibla -->
      <section data-page="qibla" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Direction de la Qibla</h2>
          <div class="text-center">
            <div class="w-64 h-64 border-8 border-emerald-500 rounded-full mx-auto mb-6 relative bg-emerald-50">
              <div class="absolute top-4 left-1/2 transform -translate-x-1/2 text-emerald-600 font-bold">ÿßŸÑÿ¥ŸÖÿßŸÑ</div>
              <div id="qibla-arrow" class="absolute w-0 h-0 border-l-8 border-r-8 border-b-24 border-transparent border-b-emerald-500 left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-3/4"></div>
            </div>
            <p class="text-slate-600 mb-4">Par d√©faut : Bobo-Dioulasso</p>
            <button id="btn-geo" class="px-4 py-2 rounded-lg bg-slate-800 text-white">
              üìç Utiliser ma position
            </button>
            <div id="qibla-text" class="mt-3 text-slate-600">Direction calcul√©e selon votre position</div>
          </div>
        </div>
      </section>
    </main>

    <footer class="mt-12 pb-10 text-center text-slate-500">
      Compagnon spirituel pour faciliter la pratique quotidienne.
    </footer>

    <!-- JavaScript int√©gr√© -->
    <script>
      // Variables globales
      let journalInitialized = false;

      // Utilitaires
      const $ = (s) => document.querySelector(s);
      const $$ = (s) => [...document.querySelectorAll(s)];

      // Configuration moment.js
      moment.locale("fr");

      // Storage API simple
      const storage = {
        get(key, defaultValue = null) {
          try {
            const value = localStorage.getItem(key);
            return value !== null ? JSON.parse(value) : defaultValue;
          } catch {
            return defaultValue;
          }
        },
        set(key, value) {
          try {
            localStorage.setItem(key, JSON.stringify(value));
            return true;
          } catch {
            return false;
          }
        },
        remove(key) {
          localStorage.removeItem(key);
        }
      };

      // Horloge et dates
      function updateClock() {
        const now = moment();
        $("#clock").textContent = now.format("HH:mm:ss");
        $("#date-greg").textContent = now.format("dddd D MMMM YYYY");
        $("#date-hijri").textContent = now.format("iD iMMMM iYYYY");
      }

      // Focus du jour
      const dailySchedule = [
        { start: "03:00", end: "04:30", name: "Dernier tiers de la nuit", activities: "Tahajjud (2‚Äì8 rak øƒÅt), du øƒÅ' sinc√®re, dhikr profond." },
        { start: "04:30", end: "05:00", name: "Pri√®re du Fajr", activities: "·π¢alƒÅt al‚ÄëFa«ßr et recueillement." },
        { start: "05:00", end: "07:00", name: "Apr√®s al-fa«ßr", activities: "AdhkƒÅr du matin, lecture/m√©morisation du Coran, m√©ditation." },
        { start: "08:00", end: "10:00", name: "Milieu de la matin√©e", activities: "·π¢alƒÅt ad‚Äë·∏åu·∏•ƒÅ (2‚Äì8 rak øƒÅt), √©tude du Coran ou des ·∏•adiths." },
        { start: "12:30", end: "13:30", name: "Pri√®re du Dhuhr", activities: "·π¢alƒÅt a·∫ì‚Äë·∫íuhr, dhikr et relecture." },
        { start: "15:30", end: "16:30", name: "Pri√®re de l'Asr", activities: "·π¢alƒÅt al‚Äë øA·π£r, dhikr, marche m√©ditative." },
        { start: "18:30", end: "19:30", name: "Pri√®re du Maghrib", activities: "·π¢alƒÅt al‚ÄëMaghrib, dhikr, salawat sur le Proph√®te." },
        { start: "19:45", end: "21:00", name: "Apr√®s al-'isha'", activities: "·π¢alƒÅt al‚Äë øIshƒÅ æ, dhikr collectif, litanies." }
      ];

      function updateDailyFocus() {
        const now = moment();
        const currentTime = now.format("HH:mm");

        const currentSlot = dailySchedule.find(slot => {
          return currentTime >= slot.start && currentTime < slot.end;
        });

        if (currentSlot) {
          $("#daily-focus-time").textContent = `Maintenant (${currentSlot.name})`;
          $("#daily-focus-content").innerHTML = `<p>${currentSlot.activities}</p>`;
        } else {
          $("#daily-focus-time").textContent = "Repos";
          $("#daily-focus-content").innerHTML = `<p>C'est un moment de transition entre les activit√©s planifi√©es.</p>`;
        }

        // Focus sp√©ciaux selon le jour
        const dayOfWeek = now.day();
        const weeklyFocusContainer = $("#weekly-special-focus");
        let weeklyHTML = '';

        // Istighfar quotidien
        weeklyHTML += `
          <div class="p-4 bg-gray-50 rounded-xl border-l-4 border-gray-400">
            <p class="font-bold text-gray-800">üìø Zikr quotidien</p>
            <p class="text-gray-600">1261√ó IstighfƒÅr</p>
          </div>`;

        if (dayOfWeek === 1 || dayOfWeek === 4) { // Lundi ou Jeudi
          weeklyHTML += `
            <div class="p-4 bg-blue-50 rounded-xl border-l-4 border-blue-400">
              <p class="font-bold text-blue-800">üåô Rappel du jour</p>
              <p class="text-blue-600">C'est lundi/jeudi, un jour propice au je√ªne sur√©rogatoire.</p>
            </div>`;
        }

        if (dayOfWeek === 5) { // Vendredi
          weeklyHTML += `
            <div class="p-4 bg-green-50 rounded-xl border-l-4 border-green-400">
              <p class="font-bold text-green-800">üïå Rappel du Vendredi</p>
              <p class="text-green-600">313√ó ·π¢alƒÅt sur le Proph√®te + Du øƒÅ æ pour les d√©funts apr√®s chaque pri√®re</p>
            </div>`;
        }

        // Nuit du mercredi
        const isWednesdayNight = (dayOfWeek === 3 && currentTime >= "19:00") || (dayOfWeek === 4 && currentTime < "04:30");
        if (isWednesdayNight) {
          weeklyHTML += `
            <div class="p-4 bg-purple-50 rounded-xl border-l-4 border-purple-400">
              <p class="font-bold text-purple-800">‚ú® Nuit du mercredi</p>
              <p class="text-purple-600">450√ó ·∏§asbunallƒÅh wa ni ømal-wakƒ´l</p>
            </div>`;
        }

        weeklyFocusContainer.innerHTML = weeklyHTML;
      }

      // Pri√®res et countdown
      const PRAYERS = [
        { name: "Fajr", time: "05:00" },
        { name: "Shuruq", time: "06:15" },
        { name: "Dhuhr", time: "12:30" },
        { name: "Asr", time: "15:45" },
        { name: "Maghrib", time: "18:30" },
        { name: "Isha", time: "19:45" }
      ];

      function todayAt(hhmm) {
        const [H, M] = hhmm.split(":").map(Number);
        return moment().clone().hours(H).minutes(M).seconds(0).milliseconds(0);
      }

      function nextPrayer() {
        const now = moment();
        for (const p of PRAYERS) {
          const t = todayAt(p.time);
          if (now.isBefore(t)) return { p, t };
        }
        return { p: PRAYERS[0], t: todayAt(PRAYERS[0].time).add(1, 'day') };
      }

      function updateCountdown() {
        const { p, t } = nextPrayer();
        $("#next-prayer-name").textContent = p.name;

        const now = moment();
        const diffMs = t.diff(now);

        if (diffMs > 0) {
          const totalSeconds = Math.floor(diffMs / 1000);
          const hours = Math.floor(totalSeconds / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;

          const hh = String(hours).padStart(2, "0");
          const mm = String(minutes).padStart(2, "0");
          const ss = String(seconds).padStart(2, "0");

          $("#next-prayer-eta").textContent = `${hh}:${mm}:${ss}`;
        } else {
          $("#next-prayer-eta").textContent = "00:00:00";
        }

        // Surbrillance
        PRAYERS.forEach((prayer) => {
          const el = $("#p-" + prayer.name);
          if (el) {
            el.classList.toggle("ring", prayer.name === p.name);
          }
        });
      }

      // Navigation onglets
      function showTab(tabName) {
        // Masquer toutes les sections
        $$("section[data-page]").forEach(section => {
          section.classList.toggle("hidden", section.dataset.page !== tabName);
        });

        // Mettre √† jour les boutons
        $$(".tab-btn").forEach(btn => {
          btn.setAttribute("aria-selected", String(btn.dataset.tab === tabName));
        });

        // Initialiser le journal si n√©cessaire
        if (tabName === 'journal' && !journalInitialized) {
          initJournal();
        }

        // Scroll vers le haut
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // Gestion du mode retraite
      function refreshRetreatMode() {
        const startDate = storage.get("retreatStart");
        const modeBadge = $("#mode-badge");

        if (!startDate) {
          modeBadge.textContent = "Planning Annuel";
          return;
        }

        const start = moment(startDate);
        const today = moment();
        const diffWeeks = today.diff(start, "weeks");
        const currentWeek = diffWeeks + 1;

        if (currentWeek > 4) {
          modeBadge.textContent = "Planning Annuel";
        } else {
          const week = Math.max(1, Math.min(currentWeek, 4));
          modeBadge.textContent = `Mode Retraite ‚Äì Semaine ${week}`;
        }
      }

      // Tableau de bord
      function updateDashboard() {
        const today = moment().format("YYYY-MM-DD");
        const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

        let prayersToday = 0;
        prayers.forEach(prayer => {
          if (storage.get(`jp:${today}:${prayer}`, false)) {
            prayersToday++;
          }
        });

        $("#prayers-today").textContent = prayersToday;
        $("#prayer-fraction").textContent = `${prayersToday}/5`;

        const prayerProgress = (prayersToday / 5) * 100;
        $("#prayer-progress").style.width = `${prayerProgress}%`;

        const dhikrCount = storage.get("tasbihCount", 0);
        $("#dhikr-count").textContent = dhikrCount;

        // Calculs simplifi√©s pour la d√©mo
        $("#streak-days").textContent = Math.min(prayersToday * 2, 7);
        $("#weekly-progress").textContent = `${Math.round((prayersToday / 5) * 100)}%`;
      }

      // Initialisation du Journal
      function initJournal() {
        if (journalInitialized) return;

        const today = moment().format("YYYY-MM-DD");

        // Charger les donn√©es sauvegard√©es
        const tasbihCount = storage.get("tasbihCount", 0);
        $("#tasbih-counter-display").textContent = tasbihCount;

        const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
        prayers.forEach(prayer => {
          const checkbox = $(`#prayer-${prayer.toLowerCase()}`);
          if (checkbox) {
            checkbox.checked = storage.get(`jp:${today}:${prayer}`, false);
          }
        });

        const noteContent = storage.get(`note:${today}`, "");
        $("#note").value = noteContent;

        // Event listeners
        $("#tasbih-counter-btn").addEventListener("click", () => {
          const current = parseInt($("#tasbih-counter-display").textContent, 10) || 0;
          const newCount = current + 1;
          $("#tasbih-counter-display").textContent = newCount;
          storage.set("tasbihCount", newCount);
          updateDashboard();
        });

        $("#tasbih-reset-btn").addEventListener("click", () => {
          $("#tasbih-counter-display").textContent = "0";
          storage.set("tasbihCount", 0);
          updateDashboard();
        });

        prayers.forEach(prayer => {
          const checkbox = $(`#prayer-${prayer.toLowerCase()}`);
          if (checkbox) {
            checkbox.addEventListener("change", () => {
              storage.set(`jp:${today}:${prayer}`, checkbox.checked);
              updateDashboard();
            });
          }
        });

        $("#note").addEventListener("input", () => {
          storage.set(`note:${today}`, $("#note").value);
        });

        // Navigation par date
        $("#journal-date-select").addEventListener("change", (e) => {
          const selectedDate = e.target.value;
          if (selectedDate) {
            const summary = $("#date-summary-content");
            const noteForDate = storage.get(`note:${selectedDate}`, "");

            let prayersForDate = 0;
            prayers.forEach(prayer => {
              if (storage.get(`jp:${selectedDate}:${prayer}`, false)) {
                prayersForDate++;
              }
            });

            summary.innerHTML = `
              <div class="space-y-2">
                <p><strong>Pri√®res:</strong> ${prayersForDate}/5 accomplies</p>
                <p><strong>Notes:</strong> ${noteForDate ? 'Pr√©sentes' : 'Aucune'}</p>
              </div>
            `;
          }
        });

        // Export/Import
        setupExportImport();
        updateJournalStats();

        journalInitialized = true;
      }

      // Export/Import des donn√©es
      function setupExportImport() {
        $("#export-data").addEventListener("click", () => {
          const data = {};
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('jp:') || key.startsWith('note:') || key === 'tasbihCount' || key === 'retreatStart') {
              data[key] = storage.get(key);
            }
          }

          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `compagnon-spirituel-${moment().format('YYYY-MM-DD')}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          showImportStatus("‚úÖ Donn√©es export√©es avec succ√®s", "success");
        });

        $("#import-data").addEventListener("click", () => {
          $("#import-file").click();
        });

        $("#import-file").addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const data = JSON.parse(event.target.result);
                Object.entries(data).forEach(([key, value]) => {
                  storage.set(key, value);
                });
                showImportStatus("‚úÖ Donn√©es import√©es avec succ√®s", "success");
                setTimeout(() => location.reload(), 1500);
              } catch {
                showImportStatus("‚ùå Erreur lors de l'import", "error");
              }
            };
            reader.readAsText(file);
          }
        });
      }

      function showImportStatus(message, type) {
        const statusEl = $("#import-status");
        statusEl.textContent = message;
        statusEl.className = `mt-4 text-sm font-medium ${type === 'error' ? 'text-red-600' : 'text-green-600'}`;
        setTimeout(() => {
          statusEl.textContent = '';
        }, 5000);
      }

      // Statistiques du journal
      function updateJournalStats() {
        let notesCount = 0;
        let totalDhikr = storage.get("tasbihCount", 0);

        for (let i = 0; i < 30; i++) {
          const date = moment().subtract(i, 'days').format('YYYY-MM-DD');
          const note = storage.get(`note:${date}`, "");
          if (note.trim().length > 0) {
            notesCount++;
          }
        }

        $("#stats-notes-count").textContent = notesCount;
        $("#stats-total-dhikr").textContent = totalDhikr;

        // S√©rie actuelle (simplifi√©e)
        let streak = 0;
        for (let i = 0; i < 7; i++) {
          const date = moment().subtract(i, 'days').format('YYYY-MM-DD');
          const note = storage.get(`note:${date}`, "");
          if (note.trim().length > 0) {
            streak++;
          } else {
            break;
          }
        }
        $("#stats-current-streak").textContent = streak;
      }

      // Configuration de la retraite
      function setupRetreat() {
        const savedDate = storage.get("retreatStart");
        if (savedDate) {
          $("#retreat-start").value = savedDate;
        }

        $("#retreat-save").addEventListener("click", () => {
          const dateValue = $("#retreat-start").value;
          if (!dateValue) {
            $("#retreat-msg").textContent = "Veuillez s√©lectionner une date de d√©but.";
            return;
          }

          storage.set("retreatStart", dateValue);
          refreshRetreatMode();
          $("#retreat-msg").textContent = "Date de retraite enregistr√©e !";
        });
      }

      // Initialisation compl√®te
      function init() {
        // Event listeners pour la navigation
        $$(".tab-btn").forEach(btn => {
          btn.addEventListener("click", () => showTab(btn.dataset.tab));
        });

        // Qibla simple
        $("#btn-geo").addEventListener("click", () => {
          $("#qibla-text").textContent = "Position g√©ographique demand√©e...";
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(() => {
              $("#qibla-text").textContent = "Direction calcul√©e selon votre position.";
            }, () => {
              $("#qibla-text").textContent = "Erreur de g√©olocalisation, direction par d√©faut.";
            });
          } else {
            $("#qibla-text").textContent = "G√©olocalisation non support√©e.";
          }
        });

        // Initialisation
        refreshRetreatMode();
        setupRetreat();
        updateDashboard();
        showTab('accueil');

        // Timers
        setInterval(() => {
          updateClock();
          updateCountdown();
          updateDailyFocus();
        }, 1000);

        // Initialisation imm√©diate
        updateClock();
        updateCountdown();
        updateDailyFocus();

        console.log('‚úÖ Compagnon Spirituel initialis√© avec succ√®s');
      }

      // Lancement apr√®s chargement DOM
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    </script>
  </body>
</html>