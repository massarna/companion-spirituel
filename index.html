<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compagnon Spirituel</title>

    <!-- Styles & Librairies externes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Configuration Tailwind pour supprimer l'avertissement
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'islamic-green': '#00a86b',
              'warm-white': '#fefcf9'
            }
          }
        }
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/locale/fr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/moment-hijri.min.js"></script>

    <!-- Polices -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Amiri:wght@400;700&family=Lato:wght@300;400;700&family=Orbitron:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- CSS uniquement -->
    <style>
      :root {
        --bg: linear-gradient(135deg, #fdfbf7 0%, #f7f3ed 100%);
        --card: rgba(255, 255, 255, 0.95);
        --card-hover: rgba(255, 255, 255, 0.98);
        --ink: #2c1810;
        --muted: #8b7355;
        --brand: #d97706;
        --ring: #059669;
        --gold: #f59e0b;
        --islamic-green: #00a86b;
        --warm-white: #fefcf9;
        --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.15);
        --gradient-islamic: linear-gradient(135deg, #00a86b 0%, #059669 100%);
        --gradient-warm: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        --border-soft: rgba(139, 115, 85, 0.2);
      }

      html,
      body {
        height: 100%;
        background: var(--bg);
        background-attachment: fixed;
        font-family:
          "Lato",
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          "Helvetica Neue",
          Arial,
          "Noto Sans",
          "Liberation Sans",
          sans-serif;
        color: var(--ink);
      }

      .title {
        font-family: "Amiri", serif;
        background: var(--gradient-islamic);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .clock {
        font-family: "Orbitron", monospace;
        letter-spacing: 0.06em;
        background: var(--gradient-warm);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .card {
        background: var(--card);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        box-shadow: var(--shadow-soft);
        border: 1px solid var(--border-soft);
        padding: 2rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-islamic);
        border-radius: 24px 24px 0 0;
      }

      .card:hover {
        background: var(--card-hover);
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
      }

      .tab-btn {
        position: relative;
        padding: 0.75rem 1.5rem;
        border-radius: 16px;
        transition: all 0.3s ease;
        font-weight: 500;
        color: var(--muted);
        border: 1px solid transparent;
      }

      .tab-btn[aria-selected="true"] {
        background: var(--gradient-islamic);
        color: white;
        box-shadow: 0 8px 25px rgba(0, 168, 107, 0.3);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .tab-btn:hover:not([aria-selected="true"]) {
        background: rgba(0, 168, 107, 0.1);
        color: var(--islamic-green);
        border-color: rgba(0, 168, 107, 0.2);
      }

      .badge {
        background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
        color: #92400e;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        font-size: 0.875rem;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        border: 1px solid rgba(251, 191, 36, 0.2);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      .arabic-text {
        font-family: "Amiri Quran", "Amiri", serif;
        font-size: 1.75rem;
        line-height: 2.5;
        direction: rtl;
        text-align: right;
        color: var(--ink);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      @media (max-width: 768px) {
        .card {
          padding: 1.5rem;
          margin: 0.5rem;
          border-radius: 16px;
        }

        /* Navigation sticky optimis√©e mobile */
        nav {
          position: fixed;
          bottom: 0;
          top: auto;
          background: rgba(253, 250, 246, 0.95);
          backdrop-filter: blur(20px);
          border-top: 1px solid rgba(139, 115, 85, 0.2);
          border-bottom: none;
          padding: 0.5rem 0;
          z-index: 30;
        }

        nav ul {
          justify-content: center;
          gap: 0.25rem;
          padding: 0 0.5rem;
        }

        .tab-btn {
          padding: 0.5rem 0.75rem;
          font-size: 0.75rem;
          border-radius: 12px;
          min-width: 0;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.25rem;
        }

        /* Ajouter des ic√¥nes aux onglets mobile */
        .tab-btn[data-tab="accueil"]::before { content: "üè†"; font-size: 1rem; }
        .tab-btn[data-tab="programme"]::before { content: "üìã"; font-size: 1rem; }
        .tab-btn[data-tab="lectures"]::before { content: "üìñ"; font-size: 1rem; }
        .tab-btn[data-tab="retraite"]::before { content: "üïå"; font-size: 1rem; }
        .tab-btn[data-tab="journal"]::before { content: "üìù"; font-size: 1rem; }
        .tab-btn[data-tab="mois"]::before { content: "üåô"; font-size: 1rem; }
        .tab-btn[data-tab="qibla"]::before { content: "üß≠"; font-size: 1rem; }

        /* Ajuster le contenu principal pour la nav bottom */
        main {
          padding-bottom: 6rem;
        }

        /* Header plus compact sur mobile */
        header {
          padding: 2rem 1rem;
        }

        header h1 {
          font-size: 2.5rem;
        }
      }
    </style>
  </head>

  <body class="text-slate-800">
    <!-- Header -->
    <header class="max-w-5xl mx-auto px-4 py-10">
      <h1 class="title text-center text-5xl sm:text-6xl text-slate-800">
        Compagnon Spirituel
      </h1>
      <p class="text-center text-[var(--brand)] mt-2">
        Votre guide spirituel quotidien
      </p>

      <!-- Horloge & Dates -->
      <div class="mt-8 card max-w-xl mx-auto text-center">
        <div id="clock" class="clock text-5xl sm:text-6xl text-slate-700">
          --:--:--
        </div>
        <div class="mt-5">
          <div id="date-greg" class="font-semibold text-sky-600">‚Äî</div>
          <div id="date-hijri" class="text-slate-500 font-medium">‚Äî</div>
          <div id="month-detail" class="text-sm text-slate-400 mt-2 italic max-w-md mx-auto">‚Äî</div>
        </div>
        <div class="mt-4">
          <span id="mode-badge" class="badge">Planning Annuel</span>
        </div>
      </div>

      <!-- Focus du jour - Version simplifi√©e stable -->
      <div class="mt-8 max-w-4xl mx-auto">
        <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-emerald-50 via-blue-50 to-indigo-100 shadow-2xl border border-white/50">
          <div class="relative p-8 md:p-12">
            <div class="text-center mb-6">
              <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-emerald-600 via-blue-600 to-indigo-600 bg-clip-text text-transparent">
                Focus du Jour
              </h2>
              <p id="daily-focus-time" class="text-lg text-slate-600 font-medium"></p>
            </div>

            <div class="relative">
              <div class="relative bg-white/70 backdrop-blur-sm rounded-2xl p-6 md:p-8 border border-white/50 shadow-lg">
                <div id="daily-focus-content" class="text-lg md:text-xl text-slate-700 leading-relaxed text-center font-medium">
                  Chargement du focus du jour...
                </div>
              </div>
            </div>

            <div id="weekly-special-focus" class="mt-8 space-y-4"></div>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="sticky top-0 z-20 bg-[var(--bg)] border-y border-slate-200/70">
      <div class="max-w-5xl mx-auto px-4">
        <ul class="flex flex-wrap gap-2 sm:gap-3 py-3">
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="accueil"
              aria-selected="true"
            >
              Accueil
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="programme"
            >
              Programme
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="lectures"
            >
              Lectures
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="retraite"
            >
              Retraite
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="journal"
            >
              Journal
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="mois"
            >
              Mois
            </button>
          </li>
          <li>
            <button
              class="tab-btn px-3 py-2 rounded-xl text-sm"
              data-tab="qibla"
            >
              Qibla
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Pages -->
    <main class="max-w-5xl mx-auto px-4 py-8 space-y-10">
      <!-- Accueil -->
      <section data-page="accueil">
        <div class="card">
          <h2 class="title text-2xl mb-4">Application Stable</h2>
          <p class="text-center text-slate-600 mb-4">
            L'application fonctionne maintenant avec une version stable sans Service Worker.
          </p>
          <div class="text-center">
            <div id="current-time" class="text-xl font-mono text-slate-800">--:--:--</div>
            <div id="current-date" class="text-slate-600 mt-2">Chargement...</div>
          </div>
        </div>
      </section>

      <!-- Programme -->
      <section data-page="programme" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Programme D√©taill√©</h2>
          <p class="text-slate-600">Section programme en d√©veloppement...</p>
        </div>
      </section>

      <!-- Lectures -->
      <section data-page="lectures" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Lectures Spirituelles</h2>
          <p class="text-slate-600">Section lectures en d√©veloppement...</p>
        </div>
      </section>

      <!-- Retraite -->
      <section data-page="retraite" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Ma Retraite</h2>
          <p class="text-slate-600">Section retraite en d√©veloppement...</p>
        </div>
      </section>

      <!-- Journal -->
      <section data-page="journal" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Mon Journal Spirituel</h2>
          <p class="text-slate-600">Section journal en d√©veloppement...</p>
        </div>
      </section>

      <!-- Mois -->
      <section data-page="mois" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Mois h√©girien</h2>
          <p class="text-slate-600">Section mois en d√©veloppement...</p>
        </div>
      </section>

      <!-- Qibla -->
      <section data-page="qibla" class="hidden">
        <div class="card">
          <h2 class="title text-2xl mb-4">Direction de la Qibla</h2>
          <p class="text-slate-600">Section qibla en d√©veloppement...</p>
        </div>
      </section>
    </main>

    <footer class="mt-12 pb-10 text-center text-slate-500">
      Compagnon spirituel - Version stable
    </footer>

    <!-- JavaScript inline pour √©viter les probl√®mes de chargement -->
    <script>
      // Fonction utilitaire
      const $ = (s) => document.querySelector(s);
      const $$ = (s) => [...document.querySelectorAll(s)];

      // Configuration de moment.js
      moment.locale("fr");

      // Horloge
      function updateClock() {
        const now = moment();
        const timeEl = $("#current-time");
        const dateEl = $("#current-date");
        const clockEl = $("#clock");
        const gregEl = $("#date-greg");
        const hijriEl = $("#date-hijri");

        if (timeEl) timeEl.textContent = now.format("HH:mm:ss");
        if (dateEl) dateEl.textContent = now.format("dddd D MMMM YYYY");
        if (clockEl) clockEl.textContent = now.format("HH:mm:ss");
        if (gregEl) gregEl.textContent = now.format("dddd D MMMM YYYY");
        if (hijriEl) hijriEl.textContent = `${now.iDate()} ${now.format('iMMMM')} ${now.iYear()}`;
      }

      // Focus du jour
      function updateDailyFocus() {
        const currentTime = moment();
        const currentTimeStr = currentTime.format("HH:mm");
        const focusTimeEl = $("#daily-focus-time");
        const focusContentEl = $("#daily-focus-content");

        if (focusTimeEl) {
          focusTimeEl.textContent = `Maintenant - ${currentTimeStr}`;
        }

        if (focusContentEl) {
          // Focus simplifi√© selon l'heure
          const hour = currentTime.hour();
          let message = "";

          if (hour >= 3 && hour < 5) {
            message = "Temps du Tahajjud et de la pri√®re nocturne";
          } else if (hour >= 5 && hour < 7) {
            message = "AdhkƒÅr du matin, lecture du Coran, m√©ditation";
          } else if (hour >= 8 && hour < 10) {
            message = "·π¢alƒÅt ad-·∏åu·∏•ƒÅ, √©tude du Coran";
          } else if (hour >= 12 && hour < 14) {
            message = "Temps de la pri√®re de Dhuhr et dhikr";
          } else if (hour >= 17 && hour < 19) {
            message = "Temps de Maghrib, dhikr et salawat";
          } else if (hour >= 20 && hour < 22) {
            message = "Temps d'Isha, dhikr collectif";
          } else {
            message = "Temps d'√©tude, de repos ou d'activit√©s personnelles";
          }

          focusContentEl.textContent = message;
        }

        // Rappels selon le jour
        const dayOfWeek = currentTime.day();
        const weeklyFocusEl = $("#weekly-special-focus");
        if (weeklyFocusEl) {
          let reminderHTML = "";

          if (dayOfWeek === 1 || dayOfWeek === 4) { // Lundi ou Jeudi
            reminderHTML += `
              <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-700 p-4 rounded-r-lg">
                <p class="font-bold">Rappel du jour :</p>
                <p>C'est lundi/jeudi, un jour propice au je√ªne sur√©rogatoire.</p>
              </div>
            `;
          }

          if (dayOfWeek === 5) { // Vendredi
            reminderHTML += `
              <div class="bg-green-50 border-l-4 border-green-400 text-green-700 p-4 rounded-r-lg">
                <p class="font-bold">Rappel du Vendredi :</p>
                <p>N'oubliez pas de lire la sourate Al-Kahf et de multiplier les pri√®res sur le Proph√®te (Ô∑∫).</p>
              </div>
            `;
          }

          weeklyFocusEl.innerHTML = reminderHTML;
        }
      }

      // Gestion des onglets
      function setupTabs() {
        const pages = $$("section[data-page]");
        const btns = $$(".tab-btn");

        function showTab(tabName) {
          // Masquer toutes les pages
          pages.forEach(page => {
            if (page.dataset.page === tabName) {
              page.classList.remove("hidden");
            } else {
              page.classList.add("hidden");
            }
          });

          // Mettre √† jour les boutons
          btns.forEach(btn => {
            if (btn.dataset.tab === tabName) {
              btn.setAttribute("aria-selected", "true");
            } else {
              btn.setAttribute("aria-selected", "false");
            }
          });

          // Scroll vers le haut
          window.scrollTo({ top: 0, behavior: "smooth" });
        }

        // Ajouter les event listeners
        btns.forEach(btn => {
          btn.addEventListener("click", () => {
            showTab(btn.dataset.tab);
          });
        });

        // Afficher l'accueil par d√©faut
        showTab("accueil");
      }

      // Initialisation
      function init() {
        console.log("Initialisation de l'application stable");

        setupTabs();
        updateClock();
        updateDailyFocus();

        // Mettre √† jour l'horloge chaque seconde
        setInterval(updateClock, 1000);

        // Mettre √† jour le focus chaque minute
        setInterval(updateDailyFocus, 60000);

        console.log("Application pr√™te !");
      }

      // D√©marrer l'application quand le DOM est pr√™t
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    </script>
  </body>
</html>